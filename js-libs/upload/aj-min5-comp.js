Math.gcd=function(e,c){var e=e?parseInt(e):1;var c=c?parseInt(c):1;var i=e>c?e:c;var g=e>c?c:e;var f=0;while(true){f=i%g;if(f==0){break}i=g;g=f}return g};Math.simplify=function(c,b){var c=c?parseInt(c):1;var b=b?parseInt(b):1;var a=Math.gcd(c,b);return[c/a,b/a]};Array.prototype.remove=function(c){for(var b=0,a=this.length;b<a;b++){if(this[b]==c){this.splice(b,1);return true}}return false};Array.prototype.insert=function(a,b){var a=parseInt(a)||null;if(a==null||a>=this.length||a<0){this.push(b);return}this.splice(a,0,b)};Array.prototype.search=function(c){for(var b=0,a=this.length;b<a;b++){if(this[b]==c){return b}}return -1};var isInfo=function(a){if(a.indexOf("trackxxxx-")!=-1){return true}else{return false}};if(!Ext){var html="<div style='margin:auto; width:600px; border:solid black 1px; padding:15px; margin-top:100px; font-family:arial; font-size:13px;'>";html+="<h1>Error: Ext not found</h1><br />";html+="<p>This application could not find the ExtJS Javascript libraries and consequently, cannot run.</p>";html+="<ul style='padding:10px; list-style:circle; font-size:12px;'>";html+="<li>Check that ExtJS libraries are included in the document &lt;head&gt; section</li>";html+="<li>Check that ExtJS libraries are included before this error checking routine</li>";html+="<li>Check that ExtJS libraries are being referenced from a correct URL</li>";html+="<li>Check that your internet connection is active</li>";html+="</ul>";html+="<p>Please notify your website administrator of this problem so that it may be fixed.</p>";html+="<p>ExtJS is available from <a href='http://www.extjs.com'>http://www.extjs.com</a></p>";html+="<p><a href='http://www.extjs.com/download'><img src='img/extjs.png' alt='Get ExtJS 2' /></a>";html+="</div>";window.onload=function(){document.body.innerHTML=html}}else{Ext.Ajax.timeout=600000;Ext.QuickTips.init()}var WebApp=(function(){function b(){if(Ext.isGecko){return true}else{if(Ext.isIE){var g=document.createElement("canvas");if(g.getContext){Ext.isIE9=true}else{Ext.isIE8=true}return true}else{if(Ext.isChrome){return true}else{if(Ext.isOpera){return true}else{if(Ext.isSafari){return true}else{return false}}}}}}function f(i,g){switch(g){case"ERROR":break;case"WARNING":break;default:g="INFO"}Ext.Msg.show({title:g,msg:i,buttons:Ext.Msg.OK,icon:Ext.MessageBox[g]})}function c(i,g){if(!Ext.isIE&&console&&console.log){console.log(i)}if(!g){var g="An exception was encountered."}a(g+"<br /><br />Details:<br />File: "+i.fileName+"<br />Line: "+i.lineNumber+"<br />Info: "+i.message)}function a(g){f(g,"ERROR")}function d(g){f(g,"WARNING")}function e(g){f(g,"INFO")}return{checkBrowser:b,alert:f,exception:c,error:a,warning:d,notice:e}})();var BaseJS=(function(){var f=function(){};var a={institution:{name:"",url:"",logo:""},engineer:{name:"",email:""},service:{title:"",version:"",description:"",request:{type:"",format:"",schema:""},response:{type:"",format:"",schema:""}}};var d={url:"",data:null,method:"GET",success:f,failure:f,requestJSON:true,receiveJSON:true};function g(i){Ext.applyIf(i||{},d);e({url:i.url||"",data:{action:"syndicate"},requestJSON:false,receiveJSON:true,success:function(j){Ext.applyIf(j.data||{},a);i.success(j.data)},failure:i.failure||f})}function c(k){var j={};Ext.apply(j,k||{},a);var i="<div style='padding:2px;'>";i+="<div><a href='"+j.institution.url+"'><img src='"+j.institution.logo+"' alt='Data provider institutional logo' /></a></div>";i+="<div><b>Provider: </b><a href='"+j.institution.url+"'>"+j.institution.name+"</a></div>";i+="<div><b>Contact: </b><a href='mailto:"+j.engineer.email+"'>"+j.engineer.name+"</a></div>";i+="<hr />";i+="<div><b>"+j.service.title+"</b></div>";i+="<div>"+j.service.description+"</div>";return i+"</div>"}function b(j){var i="<ul>";for(var k in j){if(!j.hasOwnProperty(k)){continue}if(typeof(j[k])=="string"){i+="<li><b>"+k+":</b> "+j[k]+"</li>"}else{i+=b(j[k])}}return i+"</ul>"}function e(i){Ext.applyIf(i||{},d);if(!i.url){return}if(i.method!="GET"&&i.method!="POST"){return}if(i.requestJSON){i.data={request:Ext.util.JSON.encode(i.data)}}Ext.Ajax.request({url:i.url,method:i.method,params:i.data,failure:function(j,k){i.failure("Communication error: "+j.responseText)},success:function(j,k){if(!j){i.failure("Server error: no response");return}if(i.receiveJSON){try{j=Ext.util.JSON.decode(j.responseText)}catch(l){i.failure("Illegal JSON string: "+j.responseText);return}if(j.success==false){i.failure("Server error: "+(j.message||"unspecified server error"));return}i.success(j)}else{i.success(j.responseText)}}})}return{syndicate:g,toHTML:c,request:e}})();var tokens=0;var token_ready=true;var cursor={id:"",type:"",offsetTop:"",offsetHeight:""};var defaultTrack={data:"",height:160,id:"",name:"",path:"",showControls:true,type:""};var InfoRequest={action:"merge",urls:"",source:"",ready:false,track:defaultTrack,assembly:"1",position:0,bases:10,pixels:1,corr:[]};var AnnoJ=(function(){var e={tracks:[],active:[],genome:"",bookmarks:"",styles:[],location:{assembly:"3",position:15678,bases:25,pixels:2},admin:{name:"",email:"",notes:""},cls:"tracks",citation:""};var q=e;var i={};var g=false;function l(){Ext.MessageBox.progress("Building");Ext.MessageBox.updateProgress(0.05,"","Checking browser...");if(!WebApp.checkBrowser()){Ext.MessageBox.hide();return false}Ext.MessageBox.updateProgress(0.1,"","Applying configuration...");if(!AnnoJ.config){Ext.MessageBox.hide();WebApp.error("Failed to load AnnoJ.config object.");return false}Ext.apply(q,AnnoJ.config||{},e);Ext.MessageBox.updateProgress(0.15,"","Building GUI...");try{i=d()}catch(u){Ext.MessageBox.hide();WebApp.exception(u,"An exception occured when initializing graphical user interface.");return false}i.notice("Browser check passed",true);i.notice("Configuration loaded");i.notice("GUI constructed");Ext.MessageBox.updateProgress(0.3,"","Loading stylesheets...");i.notice("Stylesheets loaded");Ext.MessageBox.updateProgress(0.4,"","Syndicating genome...");i.NavBar.syndicate({url:q.genome,success:function(v){i.notice("Genome syndicated");i.NavBar.setLocation(q.location);Ext.MessageBox.updateProgress(0.5,"","Building tracks...");s();i.notice("Tracks instantiated");AnnoJ.isReady=true},failure:function(v){Ext.MessageBox.hide();k("Unable to load genomic metadata from address: "+q.genome);Ext.MessageBox.alert("Error","Unable to load genomic metadata from address: "+q.genome)}})}function o(y){var u=i.Tracks.tracks.find("id",y);if(u){i.TrackSelector.activate(u);i.Tracks.tracks.open(u);var v=tokens/AnnoJ.config.active.length;var x=v*100;Ext.MessageBox.updateProgress(0.5+v/2,"","Loading tracks........"+x.toFixed(0)+"%")}tokens++;token_ready=true}function s(){Ext.each(q.tracks,function(y,v){try{var u=new AnnoJ[y.type](y)}catch(x){q.tracks[v]=null;WebApp.error(x);if(!Ext.isIE){console.log(x)}return}i.Tracks.tracks.manage(u);i.TrackSelector.manage(u);i.TrackSelector.expand();i.TrackSelector.active.expand();i.TrackSelector.inactive.expand()});Ext.each(i.Tracks.tracks.tracks,function(u){u.on("describe",function(v){i.InfoBox.echo(BaseJS.toHTML(v))})})}function d(){var G=new AnnoJ.Messenger();var E=new AnnoJ.TrackSelector({structure:q.structure,activeTracks:q.active});var F=new AnnoJ.Bookmarker({datasource:q.bookmarks||q.genome});var K=new AnnoJ.StyleSelector({styles:q.styles});var L=new AnnoJ.InfoBox();var A=new AnnoJ.AboutBox({admin:q.admin});var y=new AnnoJ.Navigator();var u=new AnnoJ.InfoToolBar();var J=new AnnoJ.Tracks({tbar:y.ext,tracks:q.tracks,activeTracks:q.active});var z=new AnnoJ.TracksInfo({region:"south",height:screen.height/2,tbar:u.ext,tracks:[],activeTracks:[]});if(q.citation){A.addCitation(q.citation)}var C=new Ext.Panel({title:"Configuration",region:"north",layout:"accordion",iconCls:"silk_wrench",collapsible:true,split:true,minSize:160,width:250,height:screen.height/2,maxSize:400,margins:"0 0 0 0",layoutConfig:{animate:true},items:[A,E,L,G,K,F]});var v=new Ext.Panel({title:"Information Box",region:"west",iconCls:"silk_wrench",collapsible:true,split:true,minSize:160,width:250,maxSize:400,margins:"0 0 0 0",layoutConfig:{animate:true},items:[C,z]});var x=new Ext.Viewport({layout:"border",items:[v,J]});y.on("describe",function(M){L.echo(BaseJS.toHTML(M));L.expand()});y.on("browse",J.tracks.setLocation);y.on("dragModeSet",J.setDragMode);J.on("dragModeSet",y.setDragMode);E.on("openTrack",J.tracks.open);E.on("moveTrack",J.tracks.reorder);E.on("closeTrack",J.tracks.close);F.disable();F.hide();K.disable();K.hide();function B(O,N,M){G[N](O);if(M){G.expand();C.expand()}}function D(N,M){B(N,"error",M)}function H(N,M){B(N,"warning",M)}function I(N,M){B(N,"notice",M)}return{Messenger:G,TrackSelector:E,StyleSelector:K,InfoBox:L,AboutBox:A,NavBar:y,Tracks:J,TracksInfo:z,Accordion:C,Viewport:x,Container:v,alert:B,error:D,warning:H,notice:I}}function t(){return i.NavBar.getLocation()}function c(u){return i.NavBar.setLocation(u)}function b(v,u){i.Messenger.alert(v,u)}function k(u){i.Messenger.error(u)}function j(u){i.Messenger.warning(u)}function n(u){i.Messenger.notice(u)}function p(u){return i.NavBar.pixels2bases(u)}function f(u){return i.NavBar.bases2pixels(u)}function a(u){return i.NavBar.xpos2gpos(u)}function r(u){return i.NavBar.gpos2xpos(u)}function m(){return i}return{ready:true,init:l,InitTracks:o,alert:b,isReady:g,error:k,warning:j,notice:n,getLocation:t,setLocation:c,pixels2bases:p,bases2pixels:f,xpos2gpos:a,gpos2xpos:r,getGUI:m,Plugins:{},Helpers:{}}})();var fn;if(Ext){Ext.onReady(AnnoJ.init);fn=window.setInterval(checkReady,40)}function checkReady(){if(AnnoJ&&AnnoJ.isReady){var c=AnnoJ.getGUI();if(tokens>=AnnoJ.config.active.length){window.clearInterval(fn);Ext.MessageBox.hide()}if(token_ready&&tokens<AnnoJ.config.active.length){var b=AnnoJ.config.active[tokens];token_ready=false;var a=AnnoJ.InitTracks.createCallback(b);Ext.onReady(a,this,{delay:10})}}}AnnoJ.TrackSelector=(function(){var k=new Ext.tree.TreeNode({text:"Tracks",allowDrag:false,allowDrop:false});var d=new Ext.tree.TreeNode({text:"Active Tracks",allowDrag:false,allowDrop:true,leaf:false,expandable:true,expanded:true});var c=new Ext.tree.TreeNode({text:"Inactive Tracks",allowDrag:false,allowDrop:true,leaf:false,expandable:true,expanded:true});k.appendChild(d);k.appendChild(c);function b(m){if(!m instanceof AnnoJ.BaseTrack){return}var n=f(m.config.path);var o=new Ext.tree.TreeNode({id:"tree_"+m.config.id,text:m.config.name,iconCls:m.config.iconCls,allowDrag:true,allowDrop:false,leaf:true});o.originalParent=n;o.track=m;m.node=o;n.appendChild(o);m.on("close",a)}function j(m){if(!m instanceof AnnoJ.Track){return}if(!m.node){return}m.node.remove();node.track=null;delete m.node;m.un("close",a)}function a(m){m.node.originalParent.appendChild(m.node)}function i(){Ext.each(d.childNodes,function(m){a(m.track)})}function e(m){d.appendChild(m.node)}function f(o){var n=o.split("/");var m=c;Ext.each(n,function(p){var q=m.findChild("text",p);if(!q){q=new Ext.tree.TreeNode({text:p,allowDrag:false,allowDrop:true,leaf:false})}m.appendChild(q);m=q});return m}function l(){var m=[];Ext.each(d.childNodes,function(n){m.push(n.track)});return m}function g(){var m=[];Ext.each(d.childNodes,function(n){m.push(n.track.config.id)});return m}return function(o){var m={title:"Track Selection",iconCls:"silk_package",border:false,autoScroll:true,ddScroll:true,enableDD:true,rootVisible:false,singleExpand:false,structure:[],activeTracks:[]};var n=m;Ext.apply(n,o||{},m);AnnoJ.TrackSelector.superclass.constructor.call(this,n);this.addEvents({openTrack:true,closeTrack:true,moveTrack:true});this.setRootNode(k);this.on("movenode",function(p,t,r,s,q){if(r==d){if(s==d){this.fireEvent("moveTrack",t.track,t.nextSibling?t.nextSibling.track:null)}else{t.originalParent.appendChild(t);this.fireEvent("closeTrack",t.track)}}else{if(s==d){this.fireEvent("openTrack",t.track,t.nextSibling?t.nextSibling.track:null)}else{if(t.originalParent&&s!=t.originalParent){t.originalParent.appendChild(t)}else{return}}}});this.manage=b;this.activate=e;this.inactivate=a;this.active=d;this.inactive=c;this.getActiveIDs=g;this.inactivateAll=i}})();Ext.extend(AnnoJ.TrackSelector,Ext.tree.TreePanel);AnnoJ.Navigator=function(){var b=this;this.addEvents({browse:true,describe:true,dragModeSet:true});var d=(function(){var i={};function g(j){if(!j.url){if(j.failure){j.failure("Unable to syndicate as no URL was provided")}return}BaseJS.syndicate({url:j.url,success:function(k){i=k;c.setTitle(i.service.title);if(i.genome.assemblies){c.bindAssemblies(i.genome.assemblies);AnnoJ.config.assemblies=i.genome.assemblies}if(j.success){j.success(k)}},failure:function(k){if(j.failure){j.failure(k)}}})}function f(){return i}return{get:f,syndicate:g}})();var a=(function(){var p={assembly:"",position:0,bases:10,pixels:1};var i=(function(){var u={selected:"",options:[],verbose:false};var x=u;function y(A){Ext.apply(x,A,u);z(x.selected||A.options[0].id||"")}function z(B){if(!B){return false}var A=false;Ext.each(x.options,function(C){if(C.id==B){A=true;x.selected=B;p.assembly=B;l.init({min:1,max:C.size,value:l.get()});return false}});if(x.verbose&&!A){AnnoJ.warning("Illegal assembly value selected ("+B+")")}return A}function v(){return x.selected}return{init:y,get:v,set:z}})();var l=(function(){var u={min:0,max:0,position:0,verbose:false};var y=u;var x=false;var B=false;function z(C){Ext.apply(y,C,u);A(y.position)}function v(){return y.position}function A(C){var C=parseInt(C||1);x=false;B=false;if(C<=y.min){C=y.min;x=true;if(y.verbose){AnnoJ.notice("At minimum position of assembly "+i.get())}}if(C>=y.max){C=y.max;B=true;if(y.verbose){AnnoJ.notice("At maximum position of assembly "+i.get())}}y.position=C;p.position=C}return{init:z,get:v,set:A,atMax:function(){return B},atMin:function(){return x}}})();var o=(function(){var A={max:200000,min:0.05,bases:10,pixels:1,verbose:false};var x=A;var B=false;var u=false;function D(E){Ext.apply(x,E,A);C(x.bases,x.pixels)}function z(G){if(!G){return}var E=G>0?x.bases*G:x.bases;var F=G>0?x.pixels:x.pixels*-G;C(E,F)}function v(I){var E=x.bases;var G=x.pixels;if(E>G){var F=Math.pow(10,Math.round((E+"").length)-1);var H=E/F;if(I){E=(H==1)?E-F/10:E-F}else{E=E+F}}else{if(E<G){var F=Math.pow(10,Math.round((G+"").length)-1);var H=G/F;if(I){G=G+F}else{G=(H==1)?G-F/10:G-F}}else{I?G++:E++}}C(E,G)}function y(){return{bases:x.bases,pixels:x.pixels}}function C(E,H){if(!E||!parseInt(E)){E=1}if(!H||!parseInt(H)){H=1}E=parseInt(E);H=parseInt(H);B=false;u=false;var F=E/H;if(F>=x.max){E=x.max;H=1;if(E<1){H=Math.round(1/E);E=1}u=true}else{if(F<=x.min){E=1;H=Math.round(1/x.min);if(H==0){E=Math.round(x.min);H=1}B=true}else{if(E>H){E=Math.round(E/H);H=1;var G=Math.pow(10,Math.round((E+"").length)-1);E=G*Math.round(E/G)}else{H=Math.round(H/E);E=1;var G=Math.pow(10,Math.round((H+"").length)-1);H=G*Math.round(H/G)}}}x.bases=E;x.pixels=H;p.bases=E;p.pixels=H}return{init:D,scale:z,step:v,set:C,atMax:function(){return u},atMin:function(){return B}}})();function n(){return p}function j(u){var u=Ext.apply({},u||{},p);i.set(u.assembly);l.set(u.position);o.set(u.bases,u.pixels);c.refreshControls();return p}function k(u){o.step(u)}function m(u){if(!u||!parseFloat(u)){return}o.scale(u)}function g(u){if(!u||!parseInt(u)){return}l.set(p.position+parseInt(u))}function r(u){if(!u||!parseInt(u)){return 0}return Math.round(parseInt(u)*p.bases/p.pixels)}function f(u){if(!u||!parseInt(u)){return 0}return Math.round(parseInt(u)*p.pixels/p.bases)}function q(v){var u=s();return r(v)+u.g1}function t(v){var u=s();return f(v)-u.x1}function s(){var x=Math.round(e.getBox().width/2);var u=r(x);var y=p.position;var v=f(y);return{g1:y-u,g2:y+u,x1:v-x,x2:v+x}}return{Assembly:i,Position:l,Zoom:o,getLocation:n,setLocation:j,scale:m,bump:g,step:k,pixels2bases:r,bases2pixels:f,xpos2gpos:q,gpos2xpos:t}})();var c=(function(){var y=new Ext.Button({iconCls:"silk_information",tooltip:"Show information about the track",handler:function(){b.fireEvent("describe",d.get())}});var B=new Ext.Toolbar.TextItem("Awaiting syndication...");var f=new Ext.Toolbar.Fill();AnnoJ.config.scale_method=2;AnnoJ.config.global_factor=10;AnnoJ.config.show_mode=0;AnnoJ.config.baseline=0;AnnoJ.config.hic_width=4;AnnoJ.config.hic_height=4;AnnoJ.config.hic_pos=0;AnnoJ.config.hic_d=0;AnnoJ.config.hic_x="1";AnnoJ.config.hic_y="1";var n=new Ext.form.TextField({width:30,value:0,maskRe:/[0-9]/,regex:/^[0-9]+$/,selectOnFocus:true});n.on("specialKey",function(C,D){var E=n.getValue();if(E==""){n.setValue(0)}AnnoJ.config.baseline=n.getValue()});var g=new Ext.CycleButton({showText:true,prependText:"Display as: ",tooltip:"toggle between histogram and heatmap",items:[{text:"Histogram",checked:true},{text:"Heatmap"}],changeHandler:function(G,H){if(H.text=="Heatmap"){AnnoJ.config.show_mode=1}else{AnnoJ.config.show_mode=0}var E=AnnoJ.getGUI().Tracks;if(E){for(var F in E.tracks.tracks){var D=E.tracks.tracks[F];if(AnnoJ.config.show_mode==1){if(D.setHeatmapHeight){D.setHeatmapHeight(20)}if(D.Toolbar){D.Toolbar.hide()}}if(AnnoJ.config.show_mode==0){if(D.setHeight){var C=AnnoJ.config.heightlist[D.config.id];D.setHeight(C)}if(D.Toolbar){D.Toolbar.show()}}}}}});var u=new Ext.CycleButton({showText:true,prependText:"Scale:",tooltip:"Scaling method for multiple tracks",items:[{text:"Fixed(Genome)",checked:true},{text:"Individual(Screen)"},{text:"Uniform(Screen)"}],changeHandler:function(C,D){if(D.text=="Uniform(Screen)"){AnnoJ.config.scale_method=1}else{if(D.text=="Fixed(Genome)"){AnnoJ.config.scale_method=2}else{AnnoJ.config.scale_method=0}}}});var v=new Ext.form.TextField({width:20,value:1,maskRe:/[0-9\.]/,regex:/^[0-9\.]+$/,selectOnFocus:true});v.on("specialKey",function(E,G){var H=v.getValue();if(H==""){v.setValue(1)}var D=AnnoJ.getGUI().Tracks;if(D){for(var F=0;F<D.tracks.tracks.length;F++){var C=D.tracks.tracks[F];C.Toolbar.setScale(H)}}});var r=new Ext.form.TextField({width:30,value:10,maskRe:/[0-9]/,regex:/^[0-9]+$/,selectOnFocus:true});r.on("specialKey",function(C,D){var E=r.getValue();if(E==""){r.setValue(10)}AnnoJ.config.global_factor=r.getValue()});var t=new Ext.CycleButton({showText:true,prependText:"Drag mode: ",tooltip:"Action to be performed when you click and drag in a track",items:[{text:"browse",iconCls:"silk_cursor",checked:true},{text:"zoom",iconCls:"silk_magnifier"},{text:"scale",iconCls:"silk_arrow_inout"},{text:"resize",iconCls:"silk_shape_handles"}],changeHandler:function(C,D){b.fireEvent("dragModeSet",D.text)}});Ext.EventManager.addListener(window,"keyup",function(C){if(C.getTarget().tagName=="INPUT"){return}if(C.getKey()!=16){return}t.toggleSelected()});function z(E){t.suspendEvents();var D=0;var C=t.items.length;while(t.getActiveItem().text!=E){t.toggleSelected();if(++D>C){break}}t.resumeEvents()}var k=new Ext.form.TextField({width:60,maskRe:/[0-9:]/,regex:/^[0-9]+:[0-9]+$/,selectOnFocus:true});k.on("blur",function(E,F){var G=this.getValue()||"10:1";var C=parseInt(G.split(":")[0]);var H=parseInt(G.split(":")[1]);var D=a.setLocation({bases:C,pixels:H});m();b.fireEvent("browse",a.getLocation())});k.on("specialKey",function(E,F){if(F.getKey()==F.ENTER){var G=this.getValue()||"10:1";var C=parseInt(G.split(":")[0]);var H=parseInt(G.split(":")[1]);var D=a.setLocation({bases:C,pixels:H});m();b.fireEvent("browse",a.getLocation())}});var A=new Ext.Button({iconCls:"silk_zoom_out",tooltip:"Zoom out by a fixed increment",handler:function(){if(this.disabled){return}a.step(false);m();b.fireEvent("browse",a.getLocation())}});var x=new Ext.Button({iconCls:"silk_zoom_in",tooltip:"Zoom in by a fixed increment",handler:function(){if(this.disabled){return}a.step(true);m();b.fireEvent("browse",a.getLocation())}});var o=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",width:40,grow:true,growMin:40,growMax:100,forceSelection:true,mode:"local",displayField:"id"});o.on("select",function(C){AnnoJ.config.hic_x=C.getValue()});var j=new Ext.form.NumberField({width:70,allowNegative:false,allowDecimals:false,grow:true,growMin:50,growMax:100});j.on("specialKey",function(C,D){if(D.getKey()==D.ENTER){a.setLocation({assembly:o.getValue(),position:parseInt(this.getValue())});m();b.fireEvent("browse",a.getLocation())}});var s=new Ext.Button({iconCls:"silk_server_go",text:"Go",tooltip:"Browse to the specified position",handler:function(){a.setLocation({assembly:o.getValue(),position:parseInt(j.getValue())});m();b.fireEvent("browse",a.getLocation())}});var p=new Ext.Button({iconCls:"silk_arrow_left",tooltip:"Jump one screen to the left",handler:function(){a.bump(-a.pixels2bases(e.getSize().width));m();b.fireEvent("browse",a.getLocation())}});var q=new Ext.Button({iconCls:"silk_arrow_right",tooltip:"Jump one screen to the right",handler:function(){a.bump(a.pixels2bases(e.getSize().width));m();b.fireEvent("browse",a.getLocation())}});function i(E,F){if(!E||E.length==0){return}var D=[];Ext.each(E,function(G){D.push([G.id])});if(!F){F=D[0]}var C=new Ext.data.SimpleStore({fields:["id"],data:D});o.bindStore(C);o.setValue(F);a.Assembly.init({options:E,selected:F})}function m(){var C=a.getLocation();o.setValue(AnnoJ.config.hic_x);x.enable();A.enable();if(a.Zoom.atMin()){x.disable()}if(a.Zoom.atMax()){A.disable()}k.setValue(C.bases+":"+C.pixels);p.enable();q.enable();if(a.Position.atMin()){p.disable()}if(a.Position.atMax()){q.disable()}j.setValue(C.position)}function l(C){B.el.dom.innerHTML=C}return{info:y,title:B,filler:f,dragMode:t,scaleMode:u,showMode:g,scaleBox:v,Baseline:n,GlobalscaleBox:r,ratio:k,further:A,closer:x,assembly:o,jump:j,go:s,prev:p,next:q,bindAssemblies:i,refreshControls:m,setTitle:l,setDragMode:z}})();var e=new Ext.Toolbar({cls:"AJ_Navbar",items:[c.info,c.title,"->","Baseline",c.Baseline,c.showMode,"-",c.scaleMode,"Multi",c.scaleBox,"Y-axis",c.GlobalscaleBox,"-",c.dragMode," ",c.ratio,c.further,c.closer," ",c.assembly,c.jump,c.go,c.prev,c.next]});e.on("render",function(){this.un("render");c.refreshControls()});this.ext=e;this.getLocation=a.getLocation;this.setLocation=a.setLocation;this.pixels2bases=a.pixels2bases;this.bases2pixels=a.bases2pixels;this.xpos2gpos=a.xpos2gpos;this.gpos2xpos=a.gpos2xpos;this.syndicate=d.syndicate;this.setTitle=c.setTitle;this.setDragMode=c.setDragMode};Ext.extend(AnnoJ.Navigator,Ext.util.Observable);AnnoJ.InfoToolBar=function(){var a=this;var b=(function(){var e=new Ext.CycleButton({showText:true,prependText:"Zoom:",items:[{text:"1000:1"},{text:"100:1"},{text:"10:1",checked:true},{text:"1:1"},{text:"1:5"},{text:"1:10"}],changeHandler:function(i,j){var k=j.text;InfoRequest.bases=parseInt(k.split(":")[0]);InfoRequest.pixels=parseInt(k.split(":")[1])}});var g=new Ext.CycleButton({showText:true,prependText:"",tooltip:"Scaling method for multiple tracks",items:[{text:"Merge",checked:true},{text:"Intersection"},{text:"Summation"},{text:"Subtract"},{text:"Correlation"},{text:"Intensity"}],changeHandler:function(i,j){InfoRequest.action=j.text}});var d=new Ext.CycleButton({showText:true,prependText:"Axis:",items:[{text:"X",checked:true},{text:"Y"}],changeHandler:function(i,j){if(j.text=="X"){AnnoJ.config.hic_d=0}if(j.text=="Y"){AnnoJ.config.hic_d=1}}});var f=new Ext.Button({iconCls:"silk_server_go",text:"Generate",tooltip:"Generate new track by selected",handler:function(){if(!AnnoJ.config.trks){return}InfoRequest.urls="";var o=[];Ext.apply(o,defaultTrack);var j=null;for(var l=0;l<AnnoJ.config.trks.length;l++){var q=AnnoJ.config.trks[l];var k=AnnoJ.getGUI().Tracks.tracks.find("id",q);if(k){InfoRequest.urls+=k.config.data+",";if(!j){j=k}}}var p=AnnoJ.getLocation();o.data="/proxy/http://tabit.ucsd.edu/fetchers/analysis.php";o.name=InfoRequest.action+"-"+j.config.name;o.type="ReadsTrack";if(InfoRequest.action=="Correlation"||InfoRequest.action=="Intensity"){o.id="trackyyyy-0";var n=AnnoJ.getGUI().TracksInfo.tracks.tracks[0];if(n){n.close();n=null;AnnoJ.getGUI().TracksInfo.tracks.tracks[0]=null}}else{o.height=j.config.height;o.id="new-"+j.config.id+InfoRequest.action;var n=AnnoJ.getGUI().Tracks.tracks.find("id",o.id);if(n){Ext.MessageBox.alert("Warning",o.name+" exists, please close it");return false}}try{var n=new AnnoJ[o.type](o)}catch(m){WebApp.error(m);if(!Ext.isIE){console.log(m)}return false}if(InfoRequest.action=="Correlation"||InfoRequest.action=="Intensity"){AnnoJ.getGUI().TracksInfo.tracks.tracks[0]=n;AnnoJ.getGUI().TracksInfo.tracks.open(n);if(n){n.setLocation(p)}}else{AnnoJ.getGUI().Tracks.tracks.manage(n);AnnoJ.getGUI().Tracks.tracks.insert(n,j);n.setLocation(p)}}});return{zoomMode:e,methodMode:g,HicOri:d,go:f}})();var c=new Ext.Toolbar({cls:"AJ_Navbar",items:[b.zoomMode,b.methodMode,b.HicOri,b.go]});this.ext=c};Ext.extend(AnnoJ.InfoToolBar,Ext.util.Observable);var Mouse=function(){var a=this;this.addEvents({dragStarted:true,dragged:true,dragEnded:true,dragCancelled:true,pressed:true,released:true,moved:true});var b={x:0,y:0,down:false,drag:false,downX:0,downY:0,target:null};Ext.EventManager.addListener(window,"mousedown",function(c){if(c.button!=0){return}if(c.getTarget().tagName=="INPUT"){return}b.x=c.getPageX();b.y=c.getPageY();b.drag=false;b.down=true;b.downX=b.x;b.downY=b.y;b.target=c.getTarget();a.fireEvent("pressed",b)});Ext.EventManager.addListener(window,"mousemove",function(c){b.x=c.getPageX();b.y=c.getPageY();b.target=c.getTarget();if(!b.down){a.fireEvent("moved",b);return}if(!b.drag){b.drag=true;a.fireEvent("dragStarted",b)}else{a.fireEvent("dragged",b)}});Ext.EventManager.addListener(window,"mouseup",function(c){if(c.button!=0){return}if(!b.down){return}b.x=c.getPageX();b.y=c.getPageY();b.target=c.getTarget();b.down=false;if(b.drag){b.drag=false;a.fireEvent("dragEnded",b)}else{a.fireEvent("released",b)}});Ext.EventManager.addListener(window,"keydown",function(){if(b.drag){b.drag=false;a.fireEvent("dragCancelled",b)}});this.getMouse=function(){return b}};Ext.extend(Mouse,Ext.util.Observable);var Mouse=new Mouse();AnnoJ.Bookmarker=(function(){var c="";var b=[];var j=new Ext.form.TextField({allowBlank:false,width:135});var e=new Ext.Button({text:"Save",iconCls:"silk_disk",tooltip:"Save a bookmark of the current loation",handler:function(){if(!j.isValid()){WebApp.warning("Please enter a bookmark name");return}l(j.getValue())}});var f=new Ext.Element(document.createElement("DIV"));f.addClass("AJ_bookmarks");var i=new Ext.Toolbar({items:[j,e]});function k(){if(!c){return}BaseJS.request({url:c,method:"POST",request:{action:"load"},success:function(n){b=n;m()},failure:function(n){AnnoJ.error(n)}})}function g(){if(!c){return}BaseJS.request({url:c,method:"POST",request:{action:"save",bookmarks:b},success:function(n){AnnoJ.notice(n,false)},failure:function(n){AnnoJ.error(n)}})}function m(){components.body.update("");Ext.each(b,a)}function a(o){var r=new Ext.Element(document.createElement("DIV"));var n=new Ext.Element(document.createElement("DIV"));var p=new Ext.Element(document.createElement("DIV"));r.addClass("AJ_bookmark");n.addClass("AJ_bookmark_delete");p.addClass("AJ_bookmark_select");r.bookmark=o;r.appendChild(n);r.appendChild(p);r.appendTo(f);var q=o.location;p.update(o.name+" ("+q.assembly+":"+q.position+" @ "+q.bases+":"+q.pixels+")");n.on("click",function(s){s.stopEvent();d(r.bookmark);r.remove()});p.on("click",function(s){s.stopEvent();if(!Ext.isIE){console.log(r.bookmark.location)}AnnoJ.setLocation(r.bookmark.location)})}function l(n){var p=AnnoJ.getLocation();var o={name:n,location:{assembly:p.assembly,position:p.position,bases:p.bases,pixels:p.pixels}};b.push(o);a(o)}function d(o){var n=[];Ext.each(b,function(p){if(p!=b){n.push(p)}});delete o;b=n;g()}return function(n){AnnoJ.Bookmarker.superclass.constructor.call(this,{title:"Bookmarks",border:false,iconCls:"silk_book_open",autoScroll:true,contentEl:f,tbar:i});c=n||"";this.load=k}})();Ext.extend(AnnoJ.Bookmarker,Ext.Panel);AnnoJ.Messenger=(function(){var b=new Ext.Element(document.createElement("DIV"));b.addClass("AJ_system_messages");function a(){b.update("")}function f(j,i,g){if(!i||(i!="error"&&i!="warning"&&i!="notice")){i="notice"}b.update("<div class='AJ_system_"+i+"'>"+j+"</div>"+b.dom.innerHTML)}function c(g){if(!Ext.isIE&&console){console.trace()}f(g,"error",true)}function d(g){if(!Ext.isIE&&console){console.trace()}f(g,"warning",true)}function e(i,g){f(i,"notice",g||false)}return function(){AnnoJ.Messenger.superclass.constructor.call(this,{title:"System Messages",iconCls:"silk_terminal",autoScroll:true,border:false,contentEl:b});this.clear=a;this.alert=f;this.error=c;this.warning=d;this.notice=e}})();Ext.extend(AnnoJ.Messenger,Ext.Panel);AnnoJ.InfoBox=function(){var b=this;var a=new Ext.Element(document.createElement("DIV"));a.addClass("AJ_infobox");var c={annoj:"",citation:"",message:""};AnnoJ.InfoBox.superclass.constructor.call(this,{title:"Information",iconCls:"silk_information",border:false,contentEl:a,autoScroll:true});this.echo=function(f){b.expand();if(typeof(f)=="object"){var e="<table>";for(var d in f){e+="<tr><td><b>"+d+"</b></td><td>"+f[d]+"</td></tr>"}e+="</table>";a.update(e);return}a.update(f)}};Ext.extend(AnnoJ.InfoBox,Ext.Panel);AnnoJ.AboutBox=(function(){var d={logo:"<a href='http://www.annoj.org'><img src='http://neomorph.salk.edu/epigenome/img/Anno-J.jpg' alt='Anno-J logo' /></a>",version:"Beta 1.1",engineer:"Julian Tonti-Filippini",contact:"tontij01(at)student.uwa.edu.au",copyright:"&copy; 2008 Julian Tonti-Filippini",website:"<a href='http://www.annoj.org'>http://www.annoj.org</a>",tutorial:"<a target='new' href='http://neomorph.salk.edu/index.html'>SALK example</a>",license:"<a target='new' rel='license' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'><img alt='Creative Commons License' style='border-width:0' src='http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png' /></a>"};var b=new Ext.Element(document.createElement("DIV"));var c="<div style='padding-bottom:10px;'>"+d.logo+"</div><table style='font-size:10px';><tr><td><div><b>Version: </b></td><td>"+d.version+"</div></td></tr><tr><td><div><b>Engineer: </b></td><td>"+d.engineer+"</div></td></tr><tr><td><div><b>Contact: </b></td><td>"+d.contact+"</div></td></tr><tr><td><div><b>Copyright: </b></td><td>"+d.copyright+"</div></td></tr><tr><td><div><b>Website: </b></td><td>"+d.website+"</div></td></tr><tr><td><div><b>License: </b></td><td>"+d.license+"</div></td></tr><tr><td><div><b>Tutorial: </b></td><td>"+d.tutorial+"</div></td></tr></table>";b.addClass("AJ_aboutbox");b.update(c);function a(e){b.update(e+c)}return function(){AnnoJ.AboutBox.superclass.constructor.call(this,{title:"Citation",iconCls:"silk_user_comment",border:false,contentEl:b,autoScroll:true});this.info=d;this.addCitation=a}})();Ext.extend(AnnoJ.AboutBox,Ext.Panel);AnnoJ.StyleSelector=(function(){var e=[];var a=new Ext.Element(document.createElement("TABLE"));a.addClass("AJ_style_selector");function d(i){Ext.apply({},i||{},{id:"",href:"",active:false,name:"Unknown"});if(!i.id||!i.href){return}var k=new Ext.Element(document.createElement("TR"));k.appendTo(a);var j=new Ext.Element(document.createElement("TD"));var g=new Ext.Element(document.createElement("TD"));k.appendChild(j);k.appendChild(g);g.update(i.name);var f=new Ext.form.Checkbox({checked:i.active,renderTo:j});f.css=i;f.on("check",function(m,l){l?c(m.css):b(m.css)});e.push(i);if(i.active){i.active=false;c(i)}}function c(g){if(g.active){return}var i=document.createElement("LINK");i.setAttribute("id",g.id);i.setAttribute("type","text/css");i.setAttribute("rel","stylesheet");i.setAttribute("href",g.href);var f=document.getElementsByTagName("HEAD")[0];f.appendChild(i);g.active=true}function b(f){if(!f.active){return}var g=document.getElementById(f.id);if(g){g.parentNode.removeChild(g)}f.active=false}return function(){AnnoJ.StyleSelector.superclass.constructor.call(this,{title:"Styles",iconCls:"silk_css",autoScroll:true,border:false,contentEl:a});this.manage=d}})();Ext.extend(AnnoJ.StyleSelector,Ext.Panel);AnnoJ.Tracks=function(f){var c=this;var b=new Ext.Element(document.createElement("DIV"));b.addClass("AJ_tracks");var a={title:"Tracks",region:"center",iconCls:"silk_bricks",deferredRender:true,contentEl:b,autoScroll:false,margin:"0 0 0 0"};var e=a;Ext.apply(e,f||{},a);AnnoJ.Tracks.superclass.constructor.call(this,e);c.addEvents({dragStarted:true,dragCancelled:true,dragEnded:true,dragged:true,dragModeSet:true});var d={x:0,y:0,down:false,drag:false,downX:0,downY:0};b.on("scroll",function(i){d.drag=false;d.down=false});b.on("mousedown",function(i){if(i.button!=0){return}if(i.target.tagName=="INPUT"){return}i.stopEvent();d.drag=false;d.down=true;d.downX=d.x;d.downY=d.y});b.on("mousemove",function(i){d.x=i.getPageX()-this.getX();d.y=i.getPageY()-this.getY();if(!d.down){return}if(!d.drag){d.drag=true;c.fireEvent("dragStarted",{x:d.x,y:d.y});return}c.fireEvent("dragged",{x1:d.downX,y1:d.downY,x2:d.x,y2:d.y})});Ext.EventManager.addListener(window,"mousedown",function(i){if(i.button!=0){return}d.drag=false;d.down=true;d.downX=d.x;d.downY=d.y});if(Ext.isIE7||Ext.isIE8){b.on("mouseup",function(i){if(i.button!=0){return}if(!d.down){return}d.down=false;if(d.drag){d.drag=false;c.fireEvent("dragEnded",{x:d.x,y:d.y})}else{c.fireEvent("released",d)}})}else{Ext.EventManager.addListener(window,"mouseup",function(i){if(i.button!=0){return}if(!d.down){return}d.down=false;if(d.drag){d.drag=false;c.fireEvent("dragEnded",{x:d.x,y:d.y})}})}Ext.EventManager.addListener(window,"keydown",function(){if(d.drag){d.drag=false;d.down=false;c.fireEvent("dragCancelled")}});var g="browse";this.setDragMode=function(j,i){if(d.drag){d.drag=false;c.fireEvent("dragCancelled")}if(j==g){return}switch(j){case"browse":g=j;break;case"zoom":g=j;break;case"scale":g=j;break;case"resize":g=j;break;default:g="browse"}if(i){c.fireEvent("dragModeSet",g)}};this.getDragMode=function(){return g};Ext.EventManager.addListener(window,"keyup",function(i){if(i.getTarget().tagName=="INPUT"){return}switch(i.getKey()){case 66:c.setDragMode("browse",true);break;case 82:c.setDragMode("resize",true);break;case 83:c.setDragMode("scale",true);break;case 90:c.setDragMode("zoom",true);break}});this.MouseLabel=(function(){var i=Ext.get(document.createElement("DIV"));i.addClass("AJ_mouse_label");i.appendTo(b);o(i);b.on("mousemove",function(r){r.stopEvent();var z=AnnoJ.bases2pixels(q().g1);if(d.drag){if(g=="zoom"){o();n("<div>"+AnnoJ.pixels2bases(d.x+z)+"</div>&darr;")}else{if(g=="scale"){m()}else{o()}}}else{o();var u=cursor.offsetTop-cursor.offsetHeight/2;var D;if(AnnoJ.config.scale_method==0){D=AnnoJ.config.maxlist[cursor.id]}else{if(AnnoJ.config.scale_method==2){D=AnnoJ.config.global_factor}else{D=AnnoJ.config.max}}var C=AnnoJ.config.scalerlist[cursor.id];var t=(b.dom.offsetWidth-b.dom.clientWidth)/2;InfoRequest.position=AnnoJ.pixels2bases(d.x+z+t);if(cursor.type=="HiCTrack"){var s=0;var H=1000000;var F=AnnoJ.pixels2bases(z+d.x+t);var B=AnnoJ.config.hic_pos+parseInt((cursor.offsetTop-30)*H/AnnoJ.config.hic_height);InfoRequest.position=B;var G=Math.floor(F/H);var E=Math.floor(B/H);var v=0;if(AnnoJ.config.hic_data[G]&&AnnoJ.config.hic_data[G][E]){v=AnnoJ.config.hic_data[G][E]}n("<div>"+F+","+B+","+v+"</div>&darr;")}else{if(!D||!C||AnnoJ.config.show_mode==1){n("<div>"+AnnoJ.pixels2bases(d.x+z+t)+"</div>&darr;")}else{D/=C;var A=Math.round(-u*D*20/cursor.offsetHeight)/10;n("<div>"+AnnoJ.pixels2bases(d.x+z+t)+","+A+"</div>&darr;")}}}i.setLeft(d.x-Math.round(i.getWidth()/2));i.setTop(d.y-i.getHeight()-5)});function q(){var s=Math.round(AnnoJ.pixels2bases(b.getWidth())/2);var r=AnnoJ.getLocation();return{g1:r.position-s,g2:r.position+s}}function n(r){i.update(r);l(true)}function j(){var r=c.getEdges();var s=AnnoJ.bases2pixels(r.g1);n("<div>"+AnnoJ.pixels2bases(d.x+s)+"</div>&darr;")}function p(){info_ext.setDisplayed(true);info_ext.setLeft(d.x-Math.round(i.getWidth()/2)+2);info_ext.setTop(d.y-i.getHeight()-5)}function k(){info_ext.setDisplayed(false)}function o(){i.setDisplayed(true);i.setLeft(d.x-Math.round(i.getWidth()/2)+2);i.setTop(d.y-i.getHeight()-5)}function m(){i.setDisplayed(false)}function l(r){r?o():m()}return{showText:n,showCoord:j,setDisplayed:l,show:o,hide:m}})();this.Scaler=(function(){var j=Ext.get(document.createElement("DIV"));j.setStyle("position","absolute");j.setStyle("z-index","9999");j.appendTo(b);var o=Ext.get(document.createElement("DIV"));var i=Ext.get(document.createElement("DIV"));o.appendTo(j);i.appendTo(j);o.addClass("AJ_scaler_bg");i.addClass("AJ_scaler_fg");o.setStyle("position","absolute");i.setStyle("position","absolute");i.setBottom(0);i.setLeft(0);o.setTop(0);o.setLeft(i.getWidth());var l=null;var m=1;var k=1;j.hide();function p(t,v){l=c.tracks.mouse2track(t,v);if(!l||!l.getScale||!l.setScale){l=null;return}var u=l.getScale();r(u);k=m;i.setLeft(0);o.setLeft(i.getWidth());j.show(true);j.setX(t-i.getWidth()-Math.round(o.getWidth()/2));j.setY(v-(1-m)*o.getHeight()-b.getScroll().top)}function q(){j.hide(true)}function n(v){var t=v/o.getHeight();var u=k+t;if(u<0||u>o.getHeight()){return}r(u)}function r(u){if(!l){return}if(u>1){u=1}if(u<0){u=0}var t=Math.round(20*u)/20;if(m==t){return}m=t;l.setScale(m);var x=o.getHeight()-Math.round(m*o.getHeight());i.setTop(x-Math.round(i.getHeight()/2))}function s(){return m}b.on("mousedown",function(t){if(t.button!=0){return}if(g!="scale"){return}if(t.getTarget().tagName=="INPUT"){return}p(t.getPageX()-Math.round(o.getWidth()/2)-2,t.getPageY());c.MouseLabel.hide();c.CrossHairs.hide()});b.on("mouseup",function(){if(g!="scale"){return}q()});c.on("dragEnded",function(){if(g!="scale"){return}q()});c.on("dragged",function(){if(g!="scale"){return}n(d.downY-d.y)});return{}})();this.Resizer=(function(){var m=Ext.get(document.createElement("DIV"));m.addClass("AJ_resizer");m.setStyle("position","absolute");m.appendTo(b);m.hide();var i=0;var k=null;function n(o){m.setTop(o.ext.getY()-b.getY());m.setLeft(0);m.setWidth(o.ext.getWidth());m.setHeight(o.ext.getHeight());i=m.getHeight();j()}function j(){m.show()}function l(){k=null;m.hide(true)}b.on("mousedown",function(o){if(o.button!=0){return}if(g!="resize"){return}if(o.getTarget().tagName=="INPUT"){return}k=c.tracks.mouse2track(o.getPageX(),o.getPageY());if(!k){k=null;return}n(k)});b.on("mouseup",function(o){if(g!="resize"){return}if(o.getTarget().tagName=="INPUT"){return}k.setHeight(m.getHeight());l()});c.on("dragged",function(){if(g!="resize"||!k){return}var o=i+d.y-d.downY;if(o<k.getMinHeight()){return}if(o>k.getMaxHeight()){return}m.setHeight(i+d.y-d.downY);k.setHeight(m.getHeight())});c.on("dragEnded",function(){if(g!="resize"||!k){return}k.setHeight(m.getHeight());l()});c.on("dragCancelled",function(){if(g!="resize"||!k){return}l()});return{show:j,hide:l}})();this.CrossHairs=(function(){var s=5;var o=true;var l=false;var n=Ext.get(document.createElement("DIV"));var q=Ext.get(document.createElement("DIV"));var r=Ext.get(document.createElement("DIV"));var u=Ext.get(document.createElement("DIV"));n.addClass("AJ_crosshair");q.addClass("AJ_crosshair");r.addClass("AJ_crosshair");u.addClass("AJ_crosshair");n.setStyle({position:"absolute",top:0,width:0,height:0,borderLeft:"dotted red 1px"});q.setStyle({position:"absolute",top:0,width:0,height:"100%",borderLeft:"dotted red 1px"});r.setStyle({position:"absolute",left:0,width:"100%",height:0,borderTop:"dotted red 1px"});u.setStyle({position:"absolute",left:0,width:0,height:0,borderTop:"dotted red 1px"});n.appendTo(b);q.appendTo(b);r.appendTo(b);u.appendTo(b);k(o);i(l);function j(v){s=Math.max(parseInt(v)||0,0)}function k(v){o=v?true:false;n.setDisplayed(o);q.setDisplayed(o)}function i(v){l=v?true:false;r.setDisplayed(l);u.setDisplayed(l)}function m(v,z){var v=Math.max(parseInt(v)||0,0);var z=Math.max(parseInt(z)||0,0);if(o){n.setLeft(v-1);q.setLeft(v-1);n.setHeight(z-s);q.setTop(z+s)}if(l){r.setTop(z-1);u.setTop(z-1);r.setLeft(v+s);u.setWidth(v-s)}}function t(){k(true);i(false)}function p(){k(false);i(false)}b.on("mousemove",function(v){if(d.drag){if(g=="zoom"||g=="scale"){k(false);i(false);return}}k(true);m(d.x,d.y)});return{setGap:j,toggleNS:k,toggleEW:i,setXY:m,show:t,hide:p}})();this.Region=(function(){var n=Ext.get(document.createElement("DIV"));n.addClass("AJ_region_indicator");n.appendTo(b);n.setDisplayed(false);function i(){n.setDisplayed(true)}function l(){n.setDisplayed(false)}function k(o){n.setLeft(o.x1);n.setTop(o.y1);n.setWidth(o.x2-o.x1);n.setHeight(o.y2-o.y1)}function m(){return{x1:n.getLeft(true),x2:n.getLeft(true)+n.getWidth(),y1:n.getTop(true),y2:n.getTop(true)+n.getHeight()}}function j(){var q=d.downX;var p=d.x;var s=d.downY;var r=d.y;if(q>p){var o=q;q=p;p=o}if(s>r){var o=s;s=r;r=o}return{x1:q,x2:p,y1:s,y2:r}}c.on("dragStarted",function(){if(g!="zoom"){return}k({x1:d.downX,y1:d.downY,x2:d.downX,y2:d.downY});i()});c.on("dragEnded",function(){var p=m();if(g=="browse"){l();var r=AnnoJ.getLocation();r.position-=AnnoJ.pixels2bases(d.x-d.downX);r=AnnoJ.setLocation(r);c.tracks.each(function(s){s.moveCanvas(0);s.setLocation(r)})}if(g=="zoom"){var q=n.getLeft(true);var o=n.getWidth();var r=AnnoJ.getLocation();l();if(o<10){return}r.position=AnnoJ.xpos2gpos(Math.round((p.x1+p.x2)/2));r.bases=AnnoJ.pixels2bases(p.x2-p.x1);r.pixels=b.getWidth();r=AnnoJ.setLocation(r);c.tracks.setLocation(r)}});c.on("dragged",function(){var o=j();if(g=="browse"){n.setLeft(d.x-d.downX);c.tracks.each(function(p){p.moveCanvas(d.x-d.downX)});return}if(g=="zoom"){o.y1=0;o.y2=b.getHeight();k(o);return}});c.on("dragCancelled",function(){l()});return{hide:l,show:i,setBox:k,getBox:m}})();this.tracks=(function(){var q=[];var F=[];var r=[];var o=[];var t=null;var s=null;Ext.EventManager.addListener(b.dom,"scroll",function(){clearTimeout(t);t=setTimeout(n,100)});Ext.EventManager.addListener(window,"resize",function(){clearTimeout(t);t=setTimeout(n,100)});function n(){clearTimeout(t);var J=I();o=[];r=[];Ext.each(q,function(K){if(H(K)){if(K.Syndicator.isSyndicated()){K.unmask()}r.push(K)}else{K.mask("Track temporarily disabled");o.push(K)}K.setLocation(J)})}function H(J){if(b.getTop()>J.ext.getBottom()){return false}if(b.getBottom()<J.ext.getTop()){return false}return true}function k(J){if(!J instanceof AnnoJ.BaseTrack){return}if(G(J)){return}F.push(J);J.on("generic",y);J.on("close",z);J.on("browse",m);J.on("error",D)}function i(J){if(!J instanceof AnnoJ.Track){return}z(J);F.remove(J);J.un("generic",y);J.un("close",z);J.un("browse",m);J.un("error",D)}function G(J){return F.search(J)!=-1}function x(J,L){var K=null;Ext.each(q,function(Q){var N=Q.ext.getX();var M=N+Q.ext.getWidth();var P=Q.ext.getY();var O=P+Q.ext.getHeight();if(J>=N&&J<=M&&L>=P&&L<=O){K=Q;return false}});return K}function E(J){return q.search(J)!=-1}function v(J,K){if(!G(J)){return}if(E(J)){return}q.push(J);if(K){J.insertBefore(K.ext)}else{J.appendTo(b.dom)}if(!J.Syndicator.isSyndicated()){J.Syndicator.syndicate({success:function(){J.setLocation(AnnoJ.getLocation())},failure:function(){J.mask("Error: track failed to syndicate");AnnoJ.error("Track '"+J.getID()+"' failed to syndicate");z(J)}})}else{J.unmask();J.setLocation(AnnoJ.getLocation())}n()}function z(J){if(!E(J)){return}q.remove(J);r.remove(J);o.remove(J);J.close();if(J.config.id.indexOf("new-")!=-1){F.remove(J);J.un("generic",y);J.un("close",z);J.un("browse",m);J.un("error",D)}n()}function p(J,K){if(K){J.insertBefore(K.ext)}else{J.appendTo(b.dom)}n()}function j(J,K){if(!G(J)){return}if(E(J)){return}q.push(J);if(K){J.insertBefore(K.ext)}else{J.appendTo(b.dom)}}function u(){Ext.each(q,z)}function D(J,K){AnnoJ.error("An error was generated by track: "+J.name+".<br />The track has been removed from the display.<br />Error: "+K);z(J)}function y(J,K){Ext.each(r,function(L){L.receive(J,K)})}function m(J){var J=AnnoJ.setLocation(J);Ext.each(r,function(K){K.setLocation(J)})}function I(){return AnnoJ.getLocation()}function B(){while(F.length){i(F[0])}}function A(L,K){var J=null;Ext.each(F,function(M){if(M.config[L]&&M.config[L]==K){J=M;return false}});return J}function C(){var J=[];Ext.each(F,function(K){J.push(K.config)});return J}function l(J){Ext.each(q,J)}return{manage:k,unmanage:i,clear:B,setLocation:m,getLocation:I,open:v,close:z,reorder:p,insert:j,body:b,find:A,tracks:F,getConfigs:C,closeAll:u,each:l,mouse2track:x}})()};Ext.extend(AnnoJ.Tracks,Ext.Panel);AnnoJ.TracksInfo=function(e){var c=this;var b=new Ext.Element(document.createElement("DIV"));b.addClass("AJ_tracks");var a={title:"Additonal Information",region:"south",iconCls:"silk_bricks",deferredRender:true,contentEl:b,autoScroll:false,margin:"0 0 0 0"};var d=a;Ext.apply(d,e||{},a);AnnoJ.TracksInfo.superclass.constructor.call(this,d);this.tracks=(function(){var k=[];var r=[];var p=[];var l=[];var f=null;var u=null;Ext.EventManager.addListener(b.dom,"scroll",function(){clearTimeout(f);f=setTimeout(q,100)});Ext.EventManager.addListener(window,"resize",function(){clearTimeout(f);f=setTimeout(q,100)});function q(){clearTimeout(f);var x=j();l=[];p=[];Ext.each(r,function(y){if(v(y)){if(y.Syndicator.isSyndicated()){y.unmask()}p.push(y)}else{y.mask("Track temporarily disabled");l.push(y)}y.setLocation(x)})}function v(x){if(b.getTop()>x.ext.getBottom()){return false}if(b.getBottom()<x.ext.getTop()){return false}return true}function i(x){if(!x instanceof AnnoJ.BaseTrack){return}if(m(x)){return}r.push(x);x.on("generic",propagate);x.on("close",close);x.on("browse",g);x.on("error",error)}function t(x){if(!x instanceof AnnoJ.Track){return}close(x);r.remove(x);x.un("generic",propagate);x.un("close",close);x.un("browse",g);x.un("error",error)}function m(x){return r.search(x)!=-1}function n(x){x.appendTo(b.dom)}function s(){var x="trackxxxx-"+r.length;return x}function g(x){var x=AnnoJ.setLocation(x);Ext.each(p,function(y){y.setLocation(x)})}function j(){return AnnoJ.getLocation()}function o(z,y){var x=null;Ext.each(r,function(A){if(A.config[z]&&A.config[z]==y){x=A;return false}});return x}return{manage:i,unmanage:t,setLocation:g,getLocation:j,open:n,genid:s,body:b,find:o,tracks:r}})()};Ext.extend(AnnoJ.TracksInfo,Ext.Panel);AnnoJ.Bugs=(function(){var a=Ext.get(document.createElement("DIV"));a.addClass("AJ_bugs");var c=Ext.get(document.createElement("DIV"));var b=new Ext.form.TextArea();c.appendTo(a);return function(){AnnoJ.AboutBox.superclass.constructor.call(this,{title:"Bugs",iconCls:"silk_bug",border:false,contentEl:a,autoScroll:true})}})();Ext.extend(AnnoJ.Bugs,Ext.Panel);AnnoJ.Helpers.List=function(){var a=this;this.first=null;this.last=null;this.count=0;var b=function(c){this.next=null;this.prev=null;this.value=c};this.insertFirst=function(d){var c=new b(d);if(!a.first){a.first=c;a.last=c}else{c.next=a.first;c.prev=null;c.next.prev=c;a.first=c}a.count++};this.insertLast=function(d){var c=new b(d);if(!a.last){a.first=c;a.last=c}else{c.next=null;c.prev=a.last;c.prev.next=c;a.last=c}a.count++};this.insertBefore=function(e,d){if(e==null){a.insertLast(d);return}if(!e instanceof b){return}if(e==a.first){a.insertFirst(d);return}var c=new b(d);c.next=e;c.prev=e.prev;c.next.prev=c;c.prev.next=c;a.count++};this.insertAfter=function(e,d){if(e==null){a.insertFirst(d);return}if(!e instanceof b){return}if(e==a.last){a.insertLast(d);return}var c=new b(d);c.prev=e;c.next=e.next;c.next.prev=c;c.prev.next=c;a.count++};this.remove=function(c){if(!c instanceof b){return}if(c==a.first&&c==a.last){a.first=null;a.last=null}else{if(c==a.first){a.first=c.next;a.first.prev=null}else{if(c==a.last){a.last=c.prev;a.last.next=null}else{c.next.prev=c.prev;c.prev.next=c.next}}}c.prev=null;c.next=null;temp=c.value;delete c;a.count--;return temp};this.clear=function(){var c=[];while(a.first){c.push(remove(a.first))}a.count=0;return c};this.apply=function(d){if(d==undefined||!(d instanceof Function)){return}for(var c=a.first;c;c=c.next){if(!d(c.value)){break}}};this.find=function(d){for(var c=a.first;c;c=c.next){if(c.value==d){return c}}return null}};var PointList=function(){var c={};var e=0;var b=this;var g=null;var d=null;var f=null;var a=null;var i=function(l,j,k){this.id=l||"";this.x=parseInt(j)||0;this.value=k||null;this.next=null;this.prev=null};this.getCount=function(){return e};this.getFirst=function(){return g};this.getLast=function(){return d};this.getIndex=function(){return c};this.createNode=function(l,j,k){return new i(l,j,k)};this.clear=function(){while(g){b.remove(g)}};this.prune=function(k,j){while(g&&g.x<k){b.remove(g)}while(d&&d.x>j){b.remove(d)}};this.parse=function(j){};this.subset=function(k,j){var m=[];var k=parseInt(k)||0;var j=parseInt(j)||0;if(k>j){return m}for(var l=g;l;l=l.next){if(l.x<k){continue}if(l.x>j){break}m.push(l.value)}return m};this.apply=function(m,k,j){if(!(m instanceof Function)){return}var k=parseInt(k)||g.x;var j=parseInt(j)||d.x;if(k>j){return}for(var l=g;l;l=l.next){if(l.x<k){continue}while(l){if(l.x>j){break}m(l);l=l.next}break}};this.insert=function(k){if(!(k instanceof i)){return}if(c[k.id]){c[k.id].value=k.value;return}c[k.id]=k;if(e==0){g=k;d=k;e=1;return}if(k.x<=g.x){k.next=g;g.prev=k;g=k}else{if(k.x>=d.x){k.next=null;k.prev=d;k.prev.next=k;d=k}else{if(Math.abs(k.x-g.x)<Math.abs(k.x-d.x)){for(var j=g;j;j=j.next){if(k.x<=j.x){k.next=j;k.prev=j.prev;k.next.prev=k;k.prev.next=k;break}}}else{for(var j=d;j;j=j.prev){if(k.x>=j.x){k.next=j.next;k.prev=j;k.next.prev=k;k.prev.next=k;break}}}}}e++};this.insertPoints=function(l){var j=l.length;if(j==0){return}if(e>0&&Math.abs(l[0].x-g.x)<Math.abs(l[0].x-d.x)){for(var k=j-1;k>=0;k--){b.insert(l[k])}}else{for(var k=0;k<j;k++){b.insert(l[k])}}};this.remove=function(j){if(!(j instanceof i)){return}if(!c[j.id]){return}if(e==0){return}if(e==1){g=null;d=null;f=null;a=null}else{if(j==f){f=j.next}if(j==a){a=j.prev}if(j==g){g=j.next;g.prev=null}else{if(j==d){d=j.prev;d.next=null}else{j.prev.next=j.next;j.next.prev=j.prev}}}j.prev=null;j.next=null;delete c[j.id];delete j;e--};this.viewport=(function(){function l(){return{left:f,right:a}}function n(p,o){if(e==0){j();return}var p=parseInt(p)||0;var o=parseInt(o)||0;if(p>o){return}for(var q=g;q;q=q.next){if(q.x<p){continue}f=q;while(q){if(q.x>o){break}a=q;q=q.next}break}}function m(p,o){var p=parseInt(p)||0;var o=parseInt(o)||0;if(p>o){return}if(!f||!a){n(p,o);return}while(f&&f.x<p){f=f.next}while(a&&a.x>o){a=a.prev}while(f&&f.prev&&f.prev.x>=p){f=f.prev}while(a&&a.next&&a.next.x<=o){a=a.next}}function j(){f=null;a=null}function k(p){if(!(p instanceof Function)){return}for(var o=f;o;o=o.next){p(o.value);if(o==a){break}}}return{get:l,set:n,clear:j,update:m,apply:k}})()};var RangeList=function(){var f={};var e=0;var k=this;var j=null;var d=null;var i=null;var c=null;var g=null;var b=null;var a=function(o,m,l,n){this.id=o||"";this.x1=parseInt(m)||0;this.x2=parseInt(l)||0;this.value=n||null;this.level=-1;this.nextL=null;this.nextR=null;this.prevL=null;this.prevR=null};this.getCount=function(){return e};this.getFirstL=function(){return j};this.getFirstR=function(){return d};this.getLastL=function(){return i};this.getLastR=function(){return c};this.getIndex=function(){return f};this.createNode=function(o,m,l,n){return new a(o,m,l,n)};this.exists=function(l){if(!l){return false}return f[l]?true:false};this.getNode=function(l){if(!l){return null}return f[l]||null};this.getValue=function(l){if(!l){return null}if(!f[l]){return null}return f[l].value};this.clear=function(){while(j){k.remove(j)}};this.prune=function(m,l){while(d&&d.x2<m){k.remove(d)}while(i&&i.x1>l){k.remove(i)}};this.parse=function(l){};this.apply=function(m){if(!(m instanceof Function)){return}for(var l=j;l;l=l.nextL){m(l)}};this.insert=function(m){if(!(m instanceof a)){return}if(f[m.id]){f[m.id].value=m.value;return}f[m.id]=m;if(e==0){j=m;d=m;i=m;c=m;e=1;return}if(m.x1<j.x1||(m.x1==j.x1&&m.x2<=j.x2)){m.nextL=j;j.prevL=m;j=m}else{if(m.x1>i.x1||(m.x1==i.x1&&m.x2>=i.x2)){m.nextL=null;m.prevL=i;m.prevL.nextL=m;i=m}else{if(Math.abs(m.x1-j.x1)<Math.abs(m.x1-i.x1)){for(var l=j;l;l=l.nextL){if(m.x1<l.x1||(m.x1==l.x1&&m.x2<=l.x2)){m.nextL=l;m.prevL=l.prevL;m.nextL.prevL=m;m.prevL.nextL=m;break}}}else{for(var l=i;l;l=l.prevL){if(m.x1>l.x1||(m.x1==l.x1&&m.x2>=l.x2)){m.nextL=l.nextL;m.prevL=l;m.nextL.prevL=m;m.prevL.nextL=m;break}}}}}if(m.x2<d.x2||(m.x2==d.x2&&m.x1<=d.x1)){m.nextR=d;d.prevR=m;d=m}else{if(m.x2>c.x2||(m.x2==c.x2&&m.x1>=c.x1)){m.nextR=null;m.prevR=c;m.prevR.nextR=m;c=m}else{if(Math.abs(m.x2-d.x2)<Math.abs(m.x2-c.x2)){for(var l=d;l;l=l.nextR){if(m.x2<l.x2||(m.x2==l.x2&&m.x1<=l.x1)){m.nextR=l;m.prevR=l.prevR;m.nextR.prevR=m;m.prevR.nextR=m;break}}}else{for(var l=c;l;l=l.prevR){if(m.x2>l.x2||(m.x2==l.x2&&m.x1>=l.x1)){m.nextR=l.nextR;m.prevR=l;m.nextR.prevR=m;m.prevR.nextR=m;break}}}}}e++};this.remove=function(l){if(!(l instanceof a)){return}if(!f[l.id]){return}if(e==0){return}if(l==g){g=l.nextR}if(l==b){b=l.prevL}if(e==1){j=null;d=null;i=null;c=null}else{if(l==j){j=l.nextL;j.prevL=null}else{if(l==i){i=l.prevL;i.nextL=null}else{l.prevL.nextL=l.nextL;l.nextL.prevL=l.prevL}}if(l==d){d=l.nextR;d.prevR=null}else{if(l==c){c=l.prevR;c.nextR=null}else{l.prevR.nextR=l.nextR;l.nextR.prevR=l.prevR}}}l.prevL=null;l.nextL=null;l.prevR=null;l.nextR=null;delete f[l.id];delete l;e--};this.levelize=function(q){var m=0;var o=false;var n=new lightweight_list();for(var l=j;l;l=l.nextL){if(q&&!q(l.value)){continue}o=false;l.level=0;for(var p=n.first;p;p=p.next){if(p.value.x2<=l.x1){n.remove(p)}}for(var p=n.first;p;p=p.next){if(l.level<p.value.level){n.insertAfter(p.prev,l);o=true;break}l.level++;m=Math.max(m,l.level)}if(!o){n.insertLast(l)}}return m};this.viewport=(function(){function n(){return{viewL:g,viewR:b}}function p(r,q){var r=parseInt(r)||0;var q=parseInt(q)||0;if(r>q){return}g=null;b=null;for(var s=d;s;s=s.nextR){if(s.x2<r){continue}if(s.x1>q){break}g=s;b=s;while(s){if(s.x1>q){break}if(s.x2<r){s=s.nextL;continue}b=s;s=s.nextL}break}}function o(r,q){var r=parseInt(r)||0;var q=parseInt(q)||0;if(r>q){return}if(!g||!b){p(r,q);return}while(g&&g.x2<r){g=g.nextR}while(b&&b.x1>q){b=b.prevL}while(g&&g.prevR&&g.prevR.x2>=r){g=g.prevR}while(b&&b.nextL&&b.nextL.x1<=q){b=b.nextL}}function l(){g=null;b=null}function m(r){if(!(r instanceof Function)){return false}if(!g||!b){return}for(var q=g;q;q=q.nextL){r(q);if(q==b){break}}return true}return{get:n,set:p,clear:l,update:o,apply:m}})()};var HistogramData=function(){var a={};this.clear=function(){for(var b in a){a[b].clear()}};this.prune=function(c,b){for(var d in a){a[d].prune(c,b)}};this.parse=function(d,b){if(!d){return}for(var c in d){if(a[c]==undefined){a[c]=new HistogramList()}a[c].parse(d[c],b)}};this.subset2canvas=function(f,d,c,g){var b={};for(var e in a){b[e]=a[e].subset2canvas(f,d,c,g)}return b}};var HistogramList=function(){HistogramList.superclass.constructor.call(this);var a=this;this.parse=function(d,b){var c=[];Ext.each(d,function(e){if(!e){return}if(e.length==3){var f={x:parseInt(e[0]),w:1,y:parseFloat(e[b?1:2])||0}}else{var f={x:parseInt(e[0]),w:parseInt(e[1])||0,y:parseFloat(e[b?2:3])||0}}f.id=f.x;if(!f.w||!f.y){return}c.push(a.createNode(f.id,f.x,f))});a.insertPoints(c)};this.subset2canvas=function(d,c,b,g){var f=null;var e=[];var b=parseInt(b)||0;var g=parseInt(g)||0;if(!b||!g){return e}a.viewport.update(d,c);a.viewport.apply(function(k){var i=Math.round((k.x-d)*g/b);var l=k.y;var j=Math.round(k.w*g/b)||1;if(f==null){f={x:i,y:l,w:j}}else{if(i==f.x){f.y=Math.max(f.y,l);f.w=Math.max(f.w,j)}else{e.push(f);f={x:i,y:l,w:j}}}});if(f){e.push(f)}return e}};Ext.extend(HistogramList,PointList);var ReadsList=function(){ReadsList.superclass.constructor.call(this);var a=this;this.parse=function(e,c){if(!e){return}var b=[];for(var d in e){if(!e[d]["watson"]||!e[d]["crick"]){continue}Ext.each(e[d][c?"watson":"crick"],function(f){if(f.length!=6){return}var i={cls:d,strand:c?"+":"-",id:f[0]||"",x:parseInt(f[1])||0,w:parseInt(f[2])||0,places:parseInt(f[3])||0,copies:parseInt(f[4])||0,sequence:f[5]||""};i.sequence+=","+i.copies;if(i.id&&i.x&&i.w&&i.places&&i.copies){if(i.places>1){i.cls+=" multi_mapper"}if(i.copies>1){i.cls+=" multi_copies"}var g=a.createNode(i.id,i.x,i.x+i.w-1,i);a.insert(g)}})}};this.subset2canvas=function(d,c,b,f){var e=[];var b=parseInt(b)||0;var f=parseInt(f)||0;if(!b||!f){return e}a.viewport.update(d,c);a.viewport.apply(function(g){if(g.x2<d){return true}e.push({x:Math.round((g.x1-d)*f/b),w:Math.round((g.value.w)*f/b)||1,cls:g.value.cls,sequence:g.value.sequence});return true});return e}};Ext.extend(ReadsList,RangeList);var SmallReadsList=function(){SmallReadsList.superclass.constructor.call(this);var a=this;this.parse=function(e,c){if(!e){return}var b=[];for(var d in e){if(!e[d]["watson"]||!e[d]["crick"]){continue}Ext.each(e[d][c?"watson":"crick"],function(f){if(f.length!=6){return}var i={cls:d,strand:c?"+":"-",id:f[0]||"",x:parseInt(f[1])||0,w:parseInt(f[2])||0,places:parseInt(f[3])||0,copies:parseInt(f[4])||0,sequence:f[5]||""};if(i.id&&i.x&&i.w&&i.places&&i.copies){if(i.places>1){i.cls+=" multi_mapper"}if(i.copies>1){i.cls+=" multi_copies"}switch(i.w){case 20:i.cls+=" sm21mers";break;case 21:i.cls+=" sm22mers";break;case 22:i.cls+=" sm23mers";break;case 23:i.cls+=" sm24mers";break;default:i.cls+=" Others";break}var g=a.createNode(i.id,i.x,i.x+i.w-1,i);a.insert(g)}})}}};Ext.extend(SmallReadsList,ReadsList);var ModelsList=function(){ModelsList.superclass.constructor.call(this);var a=this;this.parse=function(c,b){if(!c||!(c instanceof Array)){return}Ext.each(c,function(d){var f=d[2];if(b&&f!="+"){return}if(!b&&f!="-"){return}var i={parent:d[0],id:d[1],strand:d[2],cls:d[3],x:parseInt(d[4]),w:parseInt(d[5])};if(!i.parent){if(!a.exists(i.id)){var g=a.createNode(i.id,i.x,i.x+i.w,i);a.insert(g)}}else{var e=a.getValue(i.parent);if(e){if(!e.children){e.children={}}e.children[i.id]=i}}})};this.subset2canvas=function(d,c,b,f){var e=[];var b=parseInt(b)||0;var f=parseInt(f)||0;if(!b||!f){return e}a.viewport.update(d,c);AnnoJ.config.genome_x1=d;AnnoJ.config.genome_x2=c;AnnoJ.config.genome_ratio=b/f;a.viewport.apply(function(j){if(j.x2<d){return true}var i={id:j.id,cls:j.value.cls,x:Math.round((j.value.x-d)*f/b),w:Math.round(j.value.w*f/b)||1,children:[]};if(j.value.children){for(var l in j.value.children){var k=j.value.children[l];var g=Math.round(k.w*f/b)||0;if(g){i.children.push({id:k.id,cls:k.cls,x:Math.round((k.x-d)*f/b),w:g})}}}e.push(i);return true});return e}};Ext.extend(ModelsList,RangeList);var BaseCanvas=function(j){var l=this;l.config={};var f={};Ext.apply(l.config,j||{},f);var b=document.createElement("DIV");var e=document.createElement("CANVAS");if(!e.getContext){G_vmlCanvasManager.initElement(e)}var i=e.getContext("2d");var d=0;var k=0;b.style.position="relative";e.style.position="relative";this.getContainer=function(){return b};this.getCanvas=function(){return e};this.getBrush=function(){return i};this.getWidth=function(){return d};this.getHeight=function(){return k};this.getRegion=function(){if(!b||!b.parentNode){return null}var q=Ext.get(b.parentNode).getRegion();var m=Ext.get(b).getRegion();var n=m.intersect(q);if(!n){return null}if(n.top<0){var p=Math.abs(n.top);n.top+=p;n.bottom+=p;m.top+=p;m.bottom+=p}if(n.left<0){var p=Math.abs(n.left);n.left+=p;n.right+=p;m.left+=p;m.right+=p}var o={};o.x1=n.left-m.left;o.y1=n.top-m.top;o.x2=o.x1+n.right-n.left;o.y2=o.y1+n.bottom-n.top;return o};this.setContainer=function(m){if(!m||!m.appendChild){return}if(m.style.position!="absolute"&&m.style.position!="relative"){m.style.position="relative"}if(e.parentNode){e.parentNode.removeChild(e)}m.appendChild(e);b=m;l.clear()};this.setSize=function(n,m){b.style.width=parseInt(n)||b.offsetWidth;b.style.height=parseInt(m)||b.offsetHeight;l.refresh()};this.paint=function(){};this.refresh=function(){l.clear();l.paint()};this.refreshMap=function(){l.clear();l.paintMap()};this.clear=function(){b.removeChild(e);b.innerHTML="";if(e.innerHTML==""&&Ext.isIE){e=document.createElement("canvas");if(!e.getContext){G_vmlCanvasManager.initElement(e)}}b.appendChild(e);d=b.offsetWidth;k=b.offsetHeight;e.width=d;if((Ext.isIE8||Ext.isIE7||Ext.isOpera)){var o=b.parentNode.parentNode.parentNode.id;var n=AnnoJ.config.heightlist[o]/2;e.height=n;var m=AnnoJ.getGUI().Tracks.tracks.find("id",o);if(m&&m.config.type=="HiCTrack"){e.height*=2}}else{e.height=k}i=e.getContext("2d");i.clearRect(0,0,d,k)};this.paintBox=function(p,n,t,o,r){if(!c(n,t,o,r)){return}var q=l.styles.get(p);if(!q){return}var m=i.globalAlpha;i.globalAlpha=q.opacity;if(q.border.top.width>0){g(q.border.top.color,n,t,o,q.border.top.width);t+=q.border.top.width;r-=q.border.top.width}if(q.border.bottom.width>0){g(q.border.bottom.color,n,t+r-q.border.bottom.width,o,q.border.bottom.width);r-=q.border.bottom.width}if(q.border.left.width>0){g(q.border.left.color,n,t,q.border.left.width,r);n+=q.border.left.width;o-=q.border.left.width}if(q.border.right.width>0){g(q.border.right.color,n+o-q.border.right.width,t,q.border.right.width,r);o-=q.border.right.width}if(q.padding.top){n+=q.padding.top;r-=q.padding.top}if(q.padding.bottom){r-=q.padding.bottom}if(q.padding.left){t+=q.padding.left;o-=q.padding.left}if(q.padding.right){o-=q.padding.right}if(q.fill){g(q.fill,n,t,o,r)}if(q.image){a(q.image,q.background.repeat,n,t,o,r)}i.globalAlpha=m};function g(q,m,r,n,o){var p=c(m,r,n,o);if(!p){return}i.fillStyle=q;i.fillRect(p.x,p.y,p.w,p.h)}function a(r,m,B,A,C,t){if(!r){return}if(!r.complete){Ext.EventManager.addListener(r,"load",function(){a(r,m,B,A,C,t)});return}var s=c(B,A,C,t);if(!s){return}var z=r.width;var o=r.height;if(m=="repeat-x"){var v=Math.floor(s.w/z);var p=s.w-(v*z);for(var q=0;q<v;q++){i.drawImage(r,s.x+(q*z),s.y,z,s.h)}if(p>0&&o>0){i.drawImage(r,0,0,p,o,s.x+(q*z),s.y,p,s.h)}}else{if(m=="repeat-y"){var u=Math.floor(s.h/o);var n=s.h-(numh*o);for(var q=0;q<u;q++){i.drawImage(r,s.x,s.y+(q*o),s.w,o)}if(z>0&&n>0){i.drawImage(r,0,0,z,n,s.x,s.y+(q*o),s.w,n)}}else{i.drawImage(r,s.x,s.y,s.w,s.h)}}}function c(m,t,n,s){var p=m;var r=t;var o=m+n;var q=t+s;if(p<0){p=0}if(r<0){r=0}if(o>=d){o=d-1}if(q>=k){q=k-1}if(p>=o||o<=0||p>=d){return null}if(r>=q||q<=0||r>=k){return null}return{x:p,y:r,w:o-p,h:q-r}}this.styles=(function(){var p={};var s={};function r(t,u){if(!t||typeof(t)!="string"){return}if(p[t]&&!u){return}p[t]=q(t)}function o(t){if(!t||typeof(t)!="string"){return null}if(!p[t]){r(t)}return p[t]||null}function n(t){if(!t||typeof(t)!="string"){return}if(p[t]){delete p[t]}}function m(){delete p;p={}}function q(u){if(!u||typeof(u)!="string"){return}if(!b||!b.appendChild){b=document.body}var A=Ext.get(document.createElement("DIV"));A.addClass(u);A.appendTo(b);var x={opacity:A.getStyle("opacity"),image:null,fill:A.getColor("background-color")||"white",line:A.getColor("color")||"black",w:A.getWidth(),h:A.getHeight(),x:A.getTop(),y:A.getLeft(),background:{image:A.getStyle("background-image"),color:A.getColor("background-color"),repeat:A.getStyle("background-repeat"),position:A.getStyle("background-position")},margin:{top:A.getMargins("t"),bottom:A.getMargins("b"),left:A.getMargins("l"),right:A.getMargins("r")},border:{top:{width:A.getBorderWidth("t"),color:A.getColor("border-top-color")},bottom:{width:A.getBorderWidth("b"),color:A.getColor("border-bottom-color")},left:{width:A.getBorderWidth("l"),color:A.getColor("border-left-color")},right:{width:A.getBorderWidth("r"),color:A.getColor("border-right-color")}},padding:{top:A.getPadding("t"),bottom:A.getPadding("b"),left:A.getPadding("l"),right:A.getPadding("r")}};if(x.background.image.substr(0,4)=="url("){var z=x.background.image.indexOf("http");var t=x.background.image.indexOf(".gif");var y=x.background.image.substr(z,t-z+4);var v=new Image();v.src=y;x.image=v}else{x.image=null}A.remove();return x}return{set:r,get:o,remove:n,clear:m,build:q}})()};Ext.extend(BaseCanvas,Ext.util.Observable);var DataCanvas=function(c){var b=this;DataCanvas.superclass.constructor.call(b,c);var a={scaler:1,flippedX:false,flippedY:false};Ext.apply(b.config,c||{},a);this.setScaler=function(d,e){b.config.scaler=parseFloat(d)||0;if(b.config.scaler<0){b.config.scaler=0}if(e){b.paint()}};this.getScaler=function(){return b.config.scaler};this.flipX=function(d){b.config.flippedX=!b.config.flippedX;if(d){this.paint()}};this.flipY=function(d){b.config.flippedY=!b.config.flippedY;if(d){this.paint()}};this.isFlippedX=function(){return b.config.flippedX};this.isFlippedY=function(){return b.config.flippedY};this.groups=(function(){var j={};function i(m){return !(j[m]==undefined)}function l(m){if(i(m)){return}j[m]=true;b.styles.set(m)}function g(m){if(!i(m)){return}delete j[m];b.styles.remove(m)}function f(){j={};b.styles.clear()}function e(){return j}function d(m,n){j[m]=n?true:false}function k(m){return j[m]?true:false}return{exists:i,add:l,remove:g,clear:f,getList:e,toggle:d,active:k}})()};Ext.extend(DataCanvas,BaseCanvas);var HistogramCanvas=function(){HistogramCanvas.superclass.constructor.call(this);var b=this;var c={};var a=0;this.setData=function(e){a=0;for(var d in e){b.groups.add(d);Ext.each(e[d],function(f){a=Math.max(a,f.y)})}c=e};this.getMax=function(){return a};this.normalize=function(d){for(var e in c){Ext.each(c[e],function(f){f.y/=d})}};this.paintMap=function(){this.clear();var e=this.getBrush();var A=this.getWidth();var v=this.getHeight();var q=this.getScaler();var l=this.isFlippedX();var g=this.isFlippedY();var y=1000000;var p=AnnoJ.pixels2bases(1);var r=Math.round(y/p);var H=AnnoJ.config.hic_height;var F=Math.round(AnnoJ.pixels2bases(A)/2);var s=AnnoJ.getLocation();var o=s.position-F;var k=0;if(o<0){k=Math.round(-o/(2*F)*A);o=0}var u=Math.floor(o/y);var C=y-o%y;C=Math.round(C/y*r);var z=AnnoJ.config.hic_pos;var t=Math.floor(z/y);var d=y-z%y;d=Math.round(d/y*H);var f=30;var I=AnnoJ.config.hic_data.length;var E=AnnoJ.config.hic_data[0].length;var D=0;var x=f;var m=d;while(1){if(x>=v||(D+t)>=I){break}var G=0;var n=k;var J=C;while(1){if(n>=A||(G+u)>=E){break}var B=Math.round(255-q*AnnoJ.config.hic_data[t+D][u+G]);if(B<0){B=0}e.fillStyle="rgb(255,"+B+","+B+")";e.fillRect(n,x,J,m);n+=J;J=r;G++}x+=m;m=H;D++}};this.paint=function(){this.clear();var m=this.getBrush();var e=this.getWidth();var s=this.getHeight();var o=this.getScaler();var q=this.isFlippedX();var p=this.isFlippedY();if(Ext.isIE8||Ext.isIE7){m.canvas.style.height=s}m.fillStyle="rgb(25,25,0)";if(AnnoJ.config.show_mode==0){m.fillRect(1,0,1,s);m.fillRect(1,0,4,1)}var g,j,d;d=m.canvas.parentNode.parentNode.parentNode.parentNode.id;m.font="7pt times";m.fillStyle="rgb(25,25,0)";j=m.canvas.parentNode.className;var n;if(AnnoJ.config.maxlist){n=0;for(var k in AnnoJ.config.maxlist){if(AnnoJ.config.maxlist[k]&&n<AnnoJ.config.maxlist[k]){n=AnnoJ.config.maxlist[k]}}if(AnnoJ.config.scale_method==0){n=AnnoJ.config.maxlist[d]}if(AnnoJ.config.scale_method==1){AnnoJ.config.max=n}if(AnnoJ.config.scale_method==2){n=AnnoJ.config.global_factor}}if(n==null){g=""}else{if(d=="trackyyyy-0"){g=1}else{g=Math.round(n/b.config.scaler*10)/10}}if(AnnoJ.config.show_mode==0){if(j.indexOf("AJ_above")!=-1){m.fillText(g,2,10)}if(j.indexOf("AJ_below")!=-1){m.fillText("0",2,10);m.fillText(g,2,s-2)}}if(o==0){return}var u=new Array("#FF0000","#00FF00","#0000FF","#DC143C","#FF1493","#800080","#9932CC","#483D8B","#00008B","#149614","#1E90FF","#5F9EA0","#2F4F4F","#00FF7F","#006400","#7CFC00","#FFD700","#8B0000");if(d=="trackyyyy-0"){if(InfoRequest.corr.length==0){return}var l=InfoRequest.track.height/2;var r=Math.ceil(200/InfoRequest.corr.length);if(j.indexOf("AJ_above")!=-1){m.fillStyle=u[0]}if(j.indexOf("AJ_below")!=-1){m.fillStyle=u[2]}for(var k=0;k<InfoRequest.corr.length;k++){var f=InfoRequest.corr[k];if(j.indexOf("AJ_above")!=-1&&f>0){m.fillRect(10+k*r+1,l*(1-f),r-2,l*f)}if(j.indexOf("AJ_below")!=-1&&f<0){m.fillRect(10+k*r+1,0,r-2,-l*f)}}return}for(var t in c){if(!b.groups.active(t)){continue}if(t>=0&&t<=16){m.fillStyle=u[t];m.globalAlpha=0.7}else{m.fillStyle=b.styles.get(t).fill}if(AnnoJ.config.color&&AnnoJ.config.color[d]&&AnnoJ.config.color[d][t]){m.fillStyle="#"+AnnoJ.config.color[d][t]}Ext.each(c[t],function(z){var v=z.w||1;var A=z.y;A-=AnnoJ.config.baseline;if(A<=0){return}A/=n;A=Math.round(A*s*o);if(A==0){return}var i=q?e-z.x-v:z.x;var C=p?0:s-A-1;if(i+v<0||i>e){return}if(A>=s){C=0;A=s-1}if(AnnoJ.config.show_mode==0||isInfo(d)){m.fillRect(i,C,v,A)}else{var B=Math.ceil((z.y-AnnoJ.config.baseline)/n*255);if(B>255){B=255}if(B<0){B=0}m.fillStyle="rgb("+B+",0,0)";if(p){m.fillRect(i,0,v,10)}else{m.fillRect(i,s-10,v,10)}}})}u=null}};Ext.extend(HistogramCanvas,DataCanvas);var BoxesCanvas=function(c){var b=this;BoxesCanvas.superclass.constructor.call(b,c);var a={boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxSpace:1};Ext.apply(b.config,c,a);this.paint=function(){this.clear();var e=this.getWidth();var n=this.getHeight();var k=this.getRegion();var j=this.getBrush();var f=this.series.getAll();var m=this.isFlippedX();var l=this.isFlippedY();var i=b.config.boxHeight*this.getScaler();if(i>b.config.boxHeightMax){i=b.config.boxHeightMax}if(i<b.config.boxHeightMin){i=b.config.boxHeightMin}for(var d in f){var g=f[d];this.levelize(g);Ext.each(g,function(q){if(!b.groups.active(q.cls)){return true}var p=q.w;var o=m?e-q.x-p:q.x;var r=q.level*(i+b.config.boxSpace);r=l?r:n-r-i;if(o+p<k.x1||o>k.x2){return}if(r+i<k.y1||r>k.y2){return}b.paintBox(q.cls,o,r,p,i)})}};this.levelize=function(f){if(!f||!(f instanceof Array)){return}var e=new AnnoJ.Helpers.List();var d=0;Ext.each(f,function(j){b.groups.add(j.cls);if(!b.groups.active(j.cls)){return true}j.level=0;if(j.x1==undefined){j.x1=j.x}if(j.x2==undefined){j.x2=j.x+j.w}var g=false;for(var i=e.first;i;i=i.next){if(i.value.x2<=j.x1){e.remove(i)}}for(var i=e.first;i;i=i.next){if(j.level<i.value.level){e.insertAfter(i.prev,j);g=true;break}j.level++;d=Math.max(d,j.level)}if(!g){e.insertLast(j)}});return d}};Ext.extend(BoxesCanvas,DataCanvas);var MaskCanvas=function(c){var b=this;var d=[];MaskCanvas.superclass.constructor.call(b,c);var a={};Ext.apply(b.config,c||{},a);this.setData=function(e){if(!(e instanceof Array)){return}d=[];Ext.each(e,function(f){f.x1=f.x;f.x2=f.x+f.w});d=e};this.paint=function(){this.clear();if(!d||d.length==0){return}var e=this.getContainer();var g=this.getCanvas();var l=this.getRegion();var f=this.getWidth();var n=this.getHeight();var j=this.getBrush();var m=this.isFlippedX();if(l==null){return}var k=0;var i=n;Ext.each(d,function(q){b.groups.add(q.cls);if(!b.groups.active(q.cls)){return}var p=q.w;var o=q.x;if(m){o=f-o-p}if(o+p<l.x1||o>l.x2){return}b.paintBox(q.cls,o,k,p,i)})}};Ext.extend(MaskCanvas,BoxesCanvas);var ModelsCanvas=function(c){var b=this;var e=[];ModelsCanvas.superclass.constructor.call(b,c);var a={boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:5,boxSpace:1,labels:true,arrows:true,strand:"+"};Ext.apply(b.config,c,a);b.addEvents({modelSelected:true});if(b.config.strand=="+"&&!b.config.flippedY){b.flipY()}if(b.config.strand=="-"&&b.config.flippedY){b.flipY()}this.setBoxHeight=function(g){var g=parseInt(g)||0;if(g<b.config.boxHeightMin){g=b.config.boxHeightMin}if(g>b.config.boxHeightMax){g=b.config.boxHeightMax}b.config.boxHeight=g};this.setBoxSpace=function(g){var g=parseInt(g)||0;b.config.boxSpace=g<0?0:g};this.setLabels=function(g){b.config.labels=g?true:false};this.setArrows=function(g){b.config.arrows=g?true:false};this.setStrand=function(g){b.config.strand=(g=="+")?"+":"-"};this.setData=function(g){if(!(g instanceof Array)){return}e=[];Ext.each(g,function(i){i.x1=i.x;i.x2=i.x+i.w;b.groups.add(i.cls)});e=g};this.paint=function(){this.clear();var v=this.getContainer();var m=this.getCanvas();var n=this.getRegion();var A=this.getWidth();var y=this.getHeight();var j=this.getBrush();var r=this.getScaler();var l=this.isFlippedX();var k=this.isFlippedY();var D=r*b.config.boxHeight;if(D<b.config.boxHeightMin){D=b.config.boxHeightMin}if(D>b.config.boxHeightMax){D=b.config.boxHeightMax}var C=this.levelize(e);var p=Math.ceil(n.y2/(D+b.config.boxSpace));var t="";j.fillStyle="rgb(25,25,0)";var g=j.canvas.parentNode.className;if(g.indexOf("AJ_above")!=-1&&AnnoJ.config.genome_seq){var s=AnnoJ.config.genome_seq;var o=s.length;var q=AnnoJ.config.genome_ratio;if(q<=0.125){j.font="16px Times New Roman"}else{j.font="12px Times New Roman"}for(var B=0;B<o;B++){var F=s.charAt(B+1);var u=Math.round((B+AnnoJ.config.genome_x-AnnoJ.config.genome_x1+1)/q);if(F=="a"||F=="A"){j.fillStyle="rgb(0,255,0)"}if(F=="c"||F=="C"){j.fillStyle="rgb(0,0,255)"}if(F=="g"||F=="G"){j.fillStyle="rgb(0,0,0)"}if(F=="t"||F=="T"){j.fillStyle="rgb(255,0,0)"}if(u>0){j.fillText(F,u,30)}}AnnoJ.config.genome_seq=null}if(!e||e.length==0){return}Ext.each(e,function(H){if(!b.groups.active(H.cls)){return}if(H.level>p){return}var G=H.w;var i=H.x;var I=H.level*(D+b.config.boxSpace);if(l){i=A-i-G}if(k){I=y-I-D-b.config.boxSpace}if(i+G<n.x1||i>n.x2){return}if(I+D<n.y1||I>n.y2){return}b.paintBox(H.cls,i,I,G,D);Ext.each(H.children,function(J){b.paintBox(J.cls,J.x,I,J.w,D)});if(D>=b.config.boxBlingLimit){if(b.config.arrows){if(b.config.strand=="+"){b.paintBox("arrowRight",i+G,I,D,D)}else{b.paintBox("arrowLeft",i-D,I,D,D)}}if(b.config.labels){t+="<div class='label' style='";t+="position:absolute;";t+="top:"+I+"px;";t+="height:"+D+"px;";t+="font-size:"+D+"px;";t+="cursor:pointer;";if(b.config.strand=="+"){t+="right:"+(A-i)+"px;"}else{t+="left:"+(i+G)+"px;"}t+="'>"+H.id+"</div>"}}});var z=j.canvas.parentNode.parentNode.parentNode.parentNode.id;var x=document.createElement("DIV");x.innerHTML=t;x.id="models_"+z;v.appendChild(x);var E=Ext.get(v);E.removeListener("mouseup",f);E.addListener("mouseup",f)};function f(j,g,k){var i=Ext.get(g);if(i.hasClass("label")){b.fireEvent("modelSelected",i.dom.innerHTML)}}var d=this.levelize;this.levelize=function(l){var g=this.getContainer();var k=b.config.boxHeight*this.getScaler();var i=Ext.get(document.createElement("DIV"));i.addClass("label");i.setStyle("position","absolute");i.setStyle("visibility","hidden");i.setStyle("font-size",k);i.update("0123456789");i.appendTo(g);var j=i.getWidth(true)/10;i.remove();Ext.each(l,function(n){n.x1=n.x;n.x2=n.x+n.w;if(k>=b.config.boxBlingLimit){if(b.config.arrows){if(b.config.strand=="+"){n.x2+=k}else{n.x1-=k}}if(b.config.labels){var m=Math.round(j*n.id.length);if(b.config.strand=="+"){n.x1-=m}else{n.x2+=m}}}});return d(l)}};Ext.extend(ModelsCanvas,BoxesCanvas);var ReadsCanvas=function(d){var c=this;var e=[];ReadsCanvas.superclass.constructor.call(c,d);var b={boxHeight:8,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:5,boxSpace:1};Ext.apply(c.config,d,b);this.setData=function(f){if(!(f instanceof Array)){return}Ext.each(f,function(g){c.groups.add(g.cls)});e=f};this.toggleSpecial=function(j,i){var g=c.groups.getList();for(var f in g){if(f.indexOf(j)!=-1){c.groups.toggle(f,i)}}};this.paint=function(){this.clear();var g=this.getContainer();var j=this.getCanvas();var q=this.getRegion();var i=this.getWidth();var v=this.getHeight();var l=this.getBrush();var p=this.getScaler();var s=this.isFlippedX();var o=this.isFlippedY();var r=0;var n=0;var u=0;var k=Math.round(c.config.boxHeight*p);if(k<c.config.boxHeightMin){k=c.config.boxHeightMin}if(k>c.config.boxHeightMax){k=c.config.boxHeightMax}k+=4;var m=this.levelize(e);var t=Math.ceil(q.y2/(k+c.config.boxSpace));var f=0;Ext.each(e,function(x){c.groups.add(x.cls);if(!c.groups.active(x.cls)){return}if(x.level>t){return}if(x.multi&&!c.config.showMultis){return}var F=x.sequence.indexOf(",");var C=x.sequence.substr(0,F);var A=Math.round(x.sequence.substr(F+1));if(x.level==0){f=0}else{f+=A-1}u=x.w;r=s?i-x.x-x.w:x.x;n=(x.level+f)*(k+c.config.boxSpace);n=o?n:v-1-n-k;if(r+u<q.x1||r>q.x2){return}if(n+k<q.y1||n>q.y2){return}var B=l.canvas.parentNode.className;var G=AnnoJ.bases2pixels(1);for(var E=0;E<A;E++){if(G<5||C==""){c.paintBox(x.cls,r,n-E*(k+c.config.boxSpace),u,k)}if(C){if(B.indexOf("AJ_below")!=-1){var H="";var y=C.length;for(var D=y-1;D>=0;D--){var z=C.charAt(D);H+=z}a(l,H,r,n-E*(k+c.config.boxSpace),u,k,g)}else{a(l,C,r,n-E*(k+c.config.boxSpace),u,k,g)}}}})};function a(o,k,q,p,s,m,f){var n="";var g=k.length;var t=AnnoJ.bases2pixels(1);for(var l=0;l<g;l++){var j=k.charAt(l);switch(j){case"A":break;case"T":break;case"C":break;case"G":break;case"N":break;case"a":j="A";break;case"t":j="T";break;case"c":j="C";break;case"g":j="G";break;default:j="N"}n+=j;var r=q+(l*t);if(t<5){o.fillStyle=c.styles.get(j).fill;o.fillRect(r,p,t,m)}else{o.fillStyle=c.styles.get(j).fill;o.fillText(j,r,p+m)}}}};Ext.extend(ReadsCanvas,BoxesCanvas);AnnoJ.BaseTrack=function(c){var b=this;var a={id:Ext.id(),name:"Track",path:"",datasource:"",minHeight:40,maxHeight:1000,height:40,resizable:true,showControls:false,cls:"AJ_track",iconCls:"silk_bricks",enableMenu:true};this.config=a;Ext.apply(this.config,c||{},a);this.addEvents({generic:true,close:true,error:true,resize:true});this.Frame=(function(){var f=document.createElement("DIV");f.id=b.config.id;var e=Ext.get(f);e.addClass(b.config.cls);e.on("mousemove",function(g){cursor.id=b.config.id;cursor.type=b.config.type;var d=e.dom.offsetTop;var j=e.dom.offsetParent.offsetTop;var i=AnnoJ.getGUI().Tracks.tracks.body.dom.scrollTop;cursor.offsetTop=g.getPageY()-j+i-d;cursor.offsetHeight=e.dom.offsetHeight;return false});e.on("dblclick",function(g){g.stopEvent();if(b.config.id=="trackxxxx-0"||b.config.id=="trackyyyy-0"){return true}InfoRequest.ready=true;var l=AnnoJ.getLocation();var i=AnnoJ.getGUI().TracksInfo.tracks.tracks[0];if(i){i.close();i=null;AnnoJ.getGUI().TracksInfo.tracks.tracks[0]=null}var k=[];Ext.apply(k,defaultTrack);k.data=b.config.data;k.name=b.config.name;k.type=b.config.type;k.id="trackxxxx-0";if(b.config.type=="HiCTrack"){k.data="/proxy/http://tabit.ucsd.edu/fetchers/models/hg18_lishen.php";k.type="ModelsTrack"}InfoRequest.track.data=k.data;InfoRequest.track.type=k.type;InfoRequest.track.name=b.config.name;InfoRequest.source=b.config.type;try{var d=new AnnoJ[k.type](k)}catch(j){WebApp.error(j);if(!Ext.isIE){console.log(j)}return false}AnnoJ.getGUI().TracksInfo.tracks.tracks[0]=d;AnnoJ.getGUI().TracksInfo.tracks.open(d);if(d){d.setLocation(l)}return false});e.on("contextmenu",function(d){d.stopEvent();if(b.config.enableMenu){b.ContextMenu.ext.showAt([d.getPageX(),d.getPageY()])}return false});e.setHeight(b.config.height);if(!AnnoJ.config.heightlist){AnnoJ.config.heightlist=new Array()}AnnoJ.config.heightlist[b.config.id]=b.config.height;return{ext:e}})();this.Overflow=(function(){var d=Ext.get(document.createElement("DIV"));d.addClass("AJ_overflow");return{ext:d}})();this.Canvas=(function(){var d=Ext.get(document.createElement("DIV"));d.addClass("AJ_canvas");return{ext:d}})();this.ContextMenu=(function(){var g=new Ext.menu.Menu();function f(){b.config.enableMenu=true}function e(){b.config.enableMenu=false}function d(i){Ext.each(i,function(j){g.add(j)})}return{ext:g,enable:f,disable:e,addItems:d}})();this.Toolbar=(function(){var p=new Ext.Element(document.createElement("DIV"));p.addClass("AJ_toolbar");p.appendTo(document.body);var k=b.config.showControls;var v=new Ext.Toolbar({height:50,renderTo:p});var i=new Ext.Button({iconCls:"silk_delete",tooltip:"Remove the track",permanent:true,heatmap_permanent:true,handler:function(){b.fireEvent("close",b)}});var z=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",width:40,grow:true,growMin:40,growMax:100,forceSelection:true,mode:"local",displayField:"id"});z.on("select",function(I){AnnoJ.config.hic_y=I.getValue()});function m(K,L){if(!K||K.length==0){return}var J=[];Ext.each(K,function(M){J.push([M.id])});if(!L){L=J[0]}var I=new Ext.data.SimpleStore({fields:["id"],data:J});z.bindStore(I);z.setValue(L)}m(AnnoJ.config.assemblies);var A=new Ext.form.Checkbox({checked:false});A.on("check",function(L,K){if(K){if(!AnnoJ.config.trks){AnnoJ.config.trks=new Array()}var J=-1;for(var I=0;I<AnnoJ.config.trks.length;I++){if(AnnoJ.config.trks[I]==b.config.id){J=I;break}}if(J<0){AnnoJ.config.trks.push(b.config.id)}}else{var J=-1;for(var I=0;I<AnnoJ.config.trks.length;I++){if(AnnoJ.config.trks[I]==b.config.id){J=I;break}}if(J>=0){AnnoJ.config.trks.splice(J,1)}}});var l=new Ext.form.TextField({width:20,value:4,maskRe:/[0-9]/,regex:/^[0-9]+$/,selectOnFocus:true});l.on("specialKey",function(I,J){var K=parseInt(l.getValue());if(K<0){l.setValue(1)}if(K>100){l.setValue(100)}AnnoJ.config.hic_width=parseInt(l.getValue())||4});var n=new Ext.form.TextField({width:20,value:4,maskRe:/[0-9]/,regex:/^[0-9]+$/,selectOnFocus:true});n.on("specialKey",function(I,J){var K=parseInt(n.getValue());if(K<0){n.setValue(1)}if(K>100){n.setValue(100)}AnnoJ.config.hic_height=parseInt(n.getValue())||4});var D=new Ext.form.TextField({width:40,value:0,maskRe:/[0-9]/,regex:/^[0-9]+$/,selectOnFocus:true});D.on("specialKey",function(I,J){var K=parseInt(D.getValue());if(K<0){D.setValue(1)}AnnoJ.config.hic_pos=parseInt(D.getValue())||0});var G=new Ext.Toolbar.TextItem(b.config.name);G.permanent=true;G.heatmap_permanent=true;G.addClass("AJ_track_title");var j;if(b.config.type!="ModelsTrack"){j=new Ext.menu.Menu({items:["series"]})}function E(J){if(J=="remove"||J=="insert"||J=="search"){return}if(b.config.type=="ModelsTrack"){return}if(j){for(var I=0;I<j.items.items.length;I++){if(j.items.items[I].text==J){return}}}j.add([{text:J,menu:new Ext.menu.ColorMenu({id:J,handler:function(K,L){if(typeof L!="string"){return}if(!AnnoJ.config.color){AnnoJ.config.color=new Array()}if(!AnnoJ.config.color[b.config.id]){AnnoJ.config.color[b.config.id]=new Array()}AnnoJ.config.color[b.config.id][this.id]=L;b.refreshCanvas()}})}])}var H=new Ext.Toolbar.TextItem("scaling");H.id="AJ_val_"+b.config.id;var y=new Ext.form.TextField({width:30,maskRe:/[0-9\.]/,regex:/^[0-9\.]+$/,selectOnFocus:true});y.id="AJ_scale_box_"+b.config.id;y.setValue(1);if(!AnnoJ.config.scalerlist){AnnoJ.config.scalerlist=new Array()}AnnoJ.config.scalerlist[b.config.id]=1;function r(I){y.setValue(I);if(!AnnoJ.config.scalerlist){AnnoJ.config.scalerlist=new Array()}AnnoJ.config.scalerlist[b.config.id]=I;b.l_rescale(I)}y.on("specialKey",function(I,J){if(J.getKey()==J.ENTER){var K=y.getValue();if(K==""){y.setValue(1)}b.l_rescale(y.getValue());if(!AnnoJ.config.scalerlist){AnnoJ.config.scalerlist=new Array()}AnnoJ.config.scalerlist[b.config.id]=y.getValue()}});var d=new Ext.Toolbar.Fill();d.permanent=true;var o=new Ext.Button({iconCls:"silk_application",tooltip:"Toggles toolbar visibility",handler:C,permanent:true});var f=new Ext.Toolbar.Spacer();f.permanent=true;f.heatmap_permanent=true;var q=new Ext.Toolbar.Spacer();q.permanent=true;var g=new Ext.Toolbar.Button({text:"Color",menu:j});var x;if(isInfo(b.config.id)||b.config.id=="trackyyyy-0"){x=[G,H,y,q]}else{if(b.config.type=="ModelsTrack"){x=[i,G,d,H,y,o,q]}else{if(b.config.id.indexOf("new-")!=-1){x=[f,i,G,d,H,y,g,o,q]}else{if(b.config.type=="HiCTrack"){x=[f,z,"Y-pos",D,"Multiplier",l," ",n,i,G,d,H,y,g,o,q]}else{x=[f,A,i,G,d,H,y,g,o,q]}}}}Ext.each(x,function(I){v.add(I)});v.doLayout();C(b.config.showControls);function s(I){Ext.get(G.getEl()).update(I)}function t(I){return G.getEl().innerHTML}function C(){k?u():F()}function F(){k=true;Ext.each(x,function(I){if(I.show){I.show()}})}function u(){k=false;Ext.each(x,function(I){if(I.hide&&!I.permanent&&AnnoJ.config.show_mode==0){I.hide()}if(I.hide&&!I.heatmap_permanent&&AnnoJ.config.show_mode==1){I.hide()}})}function e(I,K){if(!K.show||!K.hide){return}var J=p.dom.parentNode;p.appendTo(document.body);x.insert(I,K);v.insert(I,K);C(k);v.doLayout();p.appendTo(J)}function B(){return k}return{ext:p,toolbar:v,addItem:E,setScale:r,setTitle:s,getTitle:t,toggle:C,show:F,hide:u,insert:e,isVisible:B}})();this.appendTo=function(e){b.Frame.ext.appendTo(e)};this.remove=function(){b.Frame.ext.remove()};this.insertBefore=function(e){b.Frame.ext.insertBefore(e)};this.insertAfter=function(e){b.Frame.ext.insertAfter(e)};this.mask=function(d){b.Frame.ext.mask(d)};this.unmask=function(){b.Frame.ext.unmask()};this.isMasked=function(){return b.Frame.ext.isMasked()};this.getTitle=function(){return b.Toolbar.getTitle()};this.setTitle=function(d){b.Toolbar.setTitle(d)};this.getWidth=function(){return b.Frame.ext.getWidth(w)};this.setWidth=function(d){b.Frame.ext.setWidth(d)};this.getHeight=function(){return b.Frame.ext.getHeight(h)};this.setHeight=function(d){b.Frame.ext.setHeight(d)};this.getMinHeight=function(){return b.config.minHeight};this.getMaxHeight=function(){return b.config.maxHeight};this.broadcast=function(d,e){this.fireEvent("generic",d,e)};this.receive=function(d,e){};this.Frame.ext.appendChild(this.Overflow.ext);this.Frame.ext.appendChild(this.Toolbar.ext);this.Overflow.ext.appendChild(this.Canvas.ext);this.ext=this.Frame.ext};Ext.extend(AnnoJ.BaseTrack,Ext.util.Observable);AnnoJ.DataTrack=function(d){AnnoJ.DataTrack.superclass.constructor.call(this,d);var c=this;var a={datasource:""};Ext.applyIf(this.config,a);this.addEvents({describe:true});var b=new Ext.Button({iconCls:"silk_information",tooltip:"Show information about the track",permanent:true,handler:function(){c.fireEvent("describe",c.Syndicator.getSyndication())}});this.Toolbar.insert(1,b);this.Communicator=(function(){var i=false;function j(){return i}function e(l,k){var k=Ext.apply(k||{},{method:"GET"});return g(l,k)}function f(l,k){var k=Ext.apply(k||{},{method:"POST"});return g(l,k)}function g(l,k){if(i){return false}c.setTitle('<span class="waiting">Communicating with server...</span>');var k=Ext.apply(k||{},{},{url:c.config.datasource,method:"POST",data:l||null,success:function(){},failure:function(){}});k.success=function(m){i=false;c.setTitle(c.config.name);k.success(m)};k.failure=function(m){i=false;c.setTitle(c.config.name);k.failure(m)};BaseJS.request(k);return true}return{isBusy:j,get:e,post:f,request:g}})();this.Syndicator=(function(){var k=null;var f=false;var i=false;function e(){return f}function g(){return k}function j(m){if(i){return}i=true;c.setTitle("Syndicating...");c.mask("<span class='waiting'>Syndicating datasource...</span>");var m=Ext.applyIf(m||{},{url:c.config.data,success:function(){},failure:function(){}});var n=m.success;var l=m.failure;m.success=function(o){f=true;k=o;i=false;if(c.config.name=="Track"){c.config.name=k.service.title}c.setTitle(c.config.name);c.unmask();n(o)};m.failure=function(o){k={};f=false;i=false;c.setTitle("Error: syndication failed");c.unmask();l(o)};BaseJS.syndicate(m)}return{isSyndicated:e,getSyndication:g,syndicate:j}})()};Ext.extend(AnnoJ.DataTrack,AnnoJ.BaseTrack);AnnoJ.BrowserTrack=function(d){AnnoJ.BrowserTrack.superclass.constructor.call(this,d);var b=this;var a={autoResize:false,autoScroll:true,minCache:100,cache:3*screen.width,maxCache:20*screen.width,scaler:0.5,dragMode:"browse"};Ext.applyIf(b.config,a);b.config.originalHeight=b.config.height;if(!isInfo(b.config.id)){this.ContextMenu.addItems([b.config.name,"-",new Ext.menu.Item({text:"Close track",iconCls:"silk_delete",handler:function(){b.fireEvent("close",b)}}),new Ext.menu.Item({text:"Track Information",iconCls:"silk_information",handler:function(){b.fireEvent("describe",b.Syndicator.getSyndication())}}),new Ext.menu.Item({text:"Toggle Toolbar",iconCls:"silk_application",handler:function(){b.Toolbar.toggle()}}),"-",new Ext.menu.Item({text:"Minimize",iconCls:"silk_arrow_down",handler:function(){b.setHeight(b.config.minHeight);b.fireEvent("resize",b.config.minHeight)}}),new Ext.menu.Item({text:"Maximize",iconCls:"silk_arrow_up",handler:function(){b.setHeight(b.config.maxHeight);b.fireEvent("resize",b.config.maxHeight)}}),new Ext.menu.Item({text:"Original Size",iconCls:"silk_arrow_undo",handler:function(){b.setHeight(b.config.originalHeight);b.fireEvent("resize",b.config.originalHeight)}})])}var e=(function(){var g=0.5;function f(){return g}function i(j){var j=parseFloat(j);if(j<0){j=0}if(j>1){j=1}g=j;b.rescale(j);return j}return{get:f,set:i}})();var c=(function(){var q={assembly:"",position:0,bases:10,pixels:1};var u={loading:q,requested:q};var f={busy:false,empty:true,ready:false,assembly:"",hic_x:"1",hic_y:"1",frameL:0,frameR:0};var r={frame:10000,bases:10,pixels:1,index:0};function j(y){var z=b.getPolicy(y);if(!z){return null}if(z.bases==undefined){return null}if(z.pixels==undefined){return null}if(z.cache==undefined){return null}if(z.index==undefined){return null}z.bases=parseInt(z.bases)||0;z.pixels=parseInt(z.pixels)||0;z.cache=parseInt(z.cache)||0;z.index=parseInt(z.index)||0;if(z.pixels<1||z.bases<1||z.cache<100*z.bases/z.pixels){return null}return z}function p(y){if(y<0){y=0}return Math.floor(Math.abs(y)/r.cache)}function s(y){return{left:Math.abs(y)*r.cache,right:(Math.abs(y)+1)*r.cache-1}}function v(){var z=Math.round(AnnoJ.pixels2bases(b.Frame.ext.getWidth())/2);var y=AnnoJ.getLocation();var A=y.position;if(isInfo(b.config.id)){A=InfoRequest.position;z=Math.round(InfoRequest.bases/InfoRequest.pixels*(b.Frame.ext.getWidth())/2)}return{g1:A-z,g2:A+z}}function g(y){return Math.round(y*u.current.bases/u.current.pixels)}function t(y){return Math.round(y*u.current.pixels/u.current.bases)}function o(){f.empty=true;b.clearData()}function m(z,y){if(f.empty){return}if(z>f.right||y<f.left){o();return}if(z>f.left){f.left=z}if(y<f.right){f.right=y}b.pruneData(s(z).left,s(y).right)}function n(y,z){if(f.empty||z<f.left){f.left=z}if(f.empty||z>f.right){f.right=z}f.empty=false;if(!y){return}var A=s(z);b.parseData(y,A.left,A.right)}function l(){return u.current}function i(C){Ext.apply(u.requested||{},C||u.requested||{},q);if(isInfo(b.config.id)&&!InfoRequest.ready){return}if(isInfo(b.config.id)){u.requested.position=InfoRequest.position;u.requested.bases=InfoRequest.bases;u.requested.pixels=InfoRequest.pixels}if(b.config.type=="HiCTrack"){if(AnnoJ.config.hic_d){u.requested.assembly=AnnoJ.config.hic_y}else{u.requested.assembly=AnnoJ.config.hic_x}InfoRequest.urls=AnnoJ.config.hic_x+","+AnnoJ.config.hic_y}var F=j(u.requested);if(!F){b.clearCanvas();b.mask("Out of zooming level");return}b.unmask();if(u.requested.assembly!=f.assembly||r.index!=F.index||(isInfo(b.config.id)&&!f.ready)||(b.config.type=="HiCTrack"&&(f.hic_x!=AnnoJ.config.hic_x||f.hic_y!=AnnoJ.config.hic_y))){o();b.clearCanvas();r=F}var y=b.config.cache*r.bases/r.pixels;if(isInfo(b.config.id)){y/=3}var B=p(u.requested.position-y);var z=p(u.requested.position+y);m(B,z);if(f.empty){x(B)}else{if(B<f.left){x(f.left-1)}else{if(z>f.right){x(f.right+1)}}}if(f.busy==false){var D=v();b.paintCanvas(D.g1,D.g2,u.requested.bases,u.requested.pixels);f.ready=false;InfoRequest.ready=false}var E=AnnoJ.bases2pixels(1);if(b.config.type=="ModelsTrack"&&E>=5&&!isInfo(b.config.id)){var A=Math.round(u.requested.position-screen.width/(E*2));var G=Math.round(u.requested.position+screen.width/(E*2));if(A<0){A=0}if(!AnnoJ.config.genome_left||!AnnoJ.config.genome_right||AnnoJ.config.genome_left!=A||AnnoJ.config.genome_right!=G){AnnoJ.config.genome_seq=null;k(A,G);AnnoJ.config.genome_left=A;AnnoJ.config.genome_right=G}}}function k(z,y){f.busy=true;b.setTitle('<span class="waiting">Updating genome...</span>');u.loading=u.requested;BaseJS.request({url:"/proxy/http://tabit.ucsd.edu/fetchers/models/hg18_genome.php",method:"POST",requestJSON:false,data:{action:"range",assembly:u.loading.assembly,left:z,right:y,bases:r.bases,pixels:r.pixels},success:function(B){u.loading=null;f.busy=false;if(B.data[0]=="GENOME"){AnnoJ.config.genome_seq=B.data[2];AnnoJ.config.genome_x=B.data[1]}b.setTitle(b.config.name);var A=v();b.paintCanvas(A.g1,A.g2,u.requested.bases,u.requested.pixels)},failure:function(A){AnnoJ.error("Failed to load genome "+b.config.name+" ("+A+")");u.loading=null;f.busy=false;b.setTitle(b.config.name)}})}function x(C){if(b.config.id.indexOf("new-")!=-1){if(r.bases/r.pixels<5){return}}if(f.busy){return}f.busy=true;b.setTitle('<span class="waiting">Updating...</span>');u.loading=u.requested;var y=b.config.data;var B=b.config.name;var D=s(C);if(isInfo(b.config.id)){y=InfoRequest.track.data;B=InfoRequest.track.name;var A=b.Frame.ext.getWidth()/2;A=Math.ceil(A/100+0.05)*100;var z=A*InfoRequest.bases/InfoRequest.pixels;if(z<1){z=1}D.left=InfoRequest.position-A*z;if(D.left<0){D.left=0}D.right=InfoRequest.position+A*z;if(InfoRequest.source=="HiCTrack"){if(AnnoJ.config.hic_d){u.loading.assembly=AnnoJ.config.hic_y}else{u.loading.assembly=AnnoJ.config.hic_x}}}BaseJS.request({url:y,method:"POST",requestJSON:false,data:{action:"range",assembly:u.loading.assembly,left:D.left,right:D.right,bases:r.bases,pixels:r.pixels,action2:InfoRequest.action,urls:InfoRequest.urls},success:function(E){if(u.loading&&u.loading.assembly!=f.assembly){f.assembly=u.loading.assembly;o()}if(b.config.id=="trackyyyy-0"){InfoRequest.corr=E.data;f.empty=false}else{if(b.config.type=="HiCTrack"){AnnoJ.config.hic_data=E.data;f.hic_x=AnnoJ.config.hic_x;f.hic_y=AnnoJ.config.hic_y;f.empty=false}else{n(E.data,C)}}u.loading=null;f.busy=false;f.ready=true;b.setTitle(B);i(u.requested)},failure:function(E){AnnoJ.error("Failed to load data for track "+b.config.name+" ("+E+")");u.loading=null;f.busy=false;f.ready=true;b.setTitle(b.config.name)}})}return{getLocation:l,setLocation:i,getEdges:v,convertX:g,convertG:t,clear:o}})();this.close=function(){b.mask("Track Closed");c.clear();b.remove()};this.moveCanvas=function(f){b.Canvas.ext.setLeft(f)};this.setHeight=function(f){if(f<b.config.minHeight){f=b.config.minHeight}if(f>b.config.maxHeight){f=b.config.maxHeight}if(AnnoJ.config.heightlist){AnnoJ.config.heightlist[b.config.id]=f}b.Frame.ext.setHeight(f);b.refreshCanvas()};this.setHeatmapHeight=function(f){if(f<10){f=10}if(AnnoJ.config.heightlist){AnnoJ.config.heightlist[b.config.id]=f}b.Frame.ext.setHeight(f);b.refreshCanvas()};this.getLocation=c.getLocation;this.setLocation=c.setLocation;this.getEdges=c.getEdges;this.convertX=c.convertX;this.convertG=c.convertG;this.setScale=e.set;this.getScale=e.get;this.clearCanvas=function(){};this.paintCanvas=function(i,g,f,j){};this.refreshCanvas=function(){};this.clearData=function(){};this.pruneData=function(g,f){};this.parseData=function(i,g,f){};this.getPolicy=function(f){return null};this.rescale=function(f){};this.setScale(b.config.scaler)};Ext.extend(AnnoJ.BrowserTrack,AnnoJ.DataTrack);AnnoJ.MaskTrack=function(i){AnnoJ.MaskTrack.superclass.constructor.call(this,i);var k=this;var f={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below"};Ext.apply(k.config,i||{},f);var e=new Ext.Element(document.createElement("DIV"));var d=new Ext.Element(document.createElement("DIV"));e.addClass(k.config.clsAbove);d.addClass(k.config.clsBelow);e.setStyle("position","relative");d.setStyle("position","relative");e.setStyle("width","100%");d.setStyle("width","100%");if(k.config.single){e.setStyle("height","100%");d.setStyle("display","none")}else{e.setStyle("height","49%");d.setStyle("height","49%");e.setStyle("borderBottom","dotted black 1px")}e.appendTo(k.Canvas.ext);d.appendTo(k.Canvas.ext);var c=(function(){var o=new ModelsList();var n=new ModelsList();function q(r){o.parse(r,true);n.parse(r,false)}var m=new MaskCanvas();var l=new MaskCanvas();m.setContainer(e.dom);l.setContainer(d.dom);function p(y,t,r,z){var x=o.subset2canvas(y,t,r,z);var u=n.subset2canvas(y,t,r,z);m.setData(x);l.setData(u);m.paint();l.paint();var v=m.groups.getList();for(var s in v){k.Toolbar.addItem(s);b(s)}v=l.groups.getList();for(var s in v){k.Toolbar.addItem(s);b(s)}}return{dataA:o,dataB:n,canvasA:m,canvasB:l,parse:q,paint:p}})();var j=c;var a=[{index:0,min:1/100,max:10/1,bases:1,pixels:1,cache:10000},{index:1,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:2,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000}];var g=null;function b(l){if(!g){k.ContextMenu.addItems(["-","Series"]);g={}}if(g[l]==undefined){g[l]=true;k.ContextMenu.addItems([new Ext.menu.CheckItem({text:l,checked:true,handler:function(){j.canvasA.groups.toggle(l,!this.checked);j.canvasB.groups.toggle(l,!this.checked);j.canvasA.refresh();j.canvasB.refresh()}})])}}this.getPolicy=function(l){var n=l.bases/l.pixels;for(var m=0;m<a.length;m++){if(n>=a[m].min&&n<a[m].max){return a[m]}}return null};this.rescale=function(){};this.clearCanvas=function(){j.canvasA.clear();j.canvasB.clear()};this.paintCanvas=function(n,o,m,q){j.paint(n,o,m,q)};this.refreshCanvas=function(){j.canvasA.refresh();j.canvasB.refresh()};this.resizeCanvas=function(){j.canvasA.refresh();j.canvasB.refresh()};this.clearData=function(){j.dataA.clear();j.dataB.clear()};this.pruneData=function(m,l){j.dataA.prune(m,l);j.dataB.prune(m,l)};this.parseData=function(l){j.parse(l)}};Ext.extend(AnnoJ.MaskTrack,AnnoJ.BrowserTrack);AnnoJ.ModelsTrack=function(l){AnnoJ.ModelsTrack.superclass.constructor.call(this,l);var n=this;var i={single:false,searchBox:true,searchURL:n.config.data,clsAbove:"AJ_above",clsBelow:"AJ_below",slider:0.5,showLabels:true,showArrows:true,labelPos:"left",boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:6};Ext.applyIf(n.config,i);var g=new Ext.Element(document.createElement("DIV"));var f=new Ext.Element(document.createElement("DIV"));g.addClass(n.config.clsAbove);f.addClass(n.config.clsBelow);g.setStyle("position","relative");f.setStyle("position","relative");g.setStyle("width","100%");f.setStyle("width","100%");if(n.config.single){g.setStyle("height","100%");f.setStyle("display","none")}else{g.setStyle("height","49%");f.setStyle("height","49%");g.setStyle("borderBottom","dotted black 1px")}g.appendTo(n.Canvas.ext);f.appendTo(n.Canvas.ext);if(n.config.searchBox){var d=new Ext.data.Store({url:n.config.searchURL,baseParams:{action:"lookup"},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"count",id:"id"},[{name:"id",mapping:"id"},{name:"assembly",mapping:"assembly"},{name:"start",mapping:"start"},{name:"end",mapping:"end"},{name:"description",mapping:"description"}])});var k=new Ext.XTemplate('<tpl for="."><div class="gi">',"<b>{id}: </b><span>{description}</span>","</div></tpl>");var o=new Ext.form.ComboBox({store:d,displayField:"id",typeAhead:false,cls:"promote",loadingText:"Searching...",width:150,pageSize:10,hideTrigger:false,tpl:k,minChars:3,minListWidth:400,itemSelector:"div.gi",emptyText:"Search...",onSelect:function(p){var q=AnnoJ.getLocation();q.assembly=p.data.assembly;q.position=parseInt(p.data.start);AnnoJ.setLocation(q);n.fireEvent("browse",q);this.collapse()}});o.on("expand",function(){if(!n.Toolbar.isVisible()){this.collapse()}});if(!isInfo(n.config.id)){n.Toolbar.insert(4,new Ext.Toolbar.Spacer());n.Toolbar.insert(4,o)}}var e=(function(){var s=new ModelsList();var r=new ModelsList();function u(v){s.parse(v,true);r.parse(v,false)}var q=new ModelsCanvas({strand:"+",labels:n.config.showLabels,arrows:n.config.showArrows,scaler:n.config.slider*2,boxHeight:n.config.boxHeight,boxHeightMax:n.config.boxHeightMax,boxHeightMin:n.config.boxHeightMin,boxBlingLimit:n.config.boxBlingLimit});var p=new ModelsCanvas({strand:"-",labels:n.config.showLabels,arrows:n.config.showArrows,scaler:n.config.slider*2,boxHeight:n.config.boxHeight,boxHeightMax:n.config.boxHeightMax,boxHeightMin:n.config.boxHeightMin,boxBlingLimit:n.config.boxBlingLimit});q.setContainer(g.dom);p.setContainer(f.dom);q.on("modelSelected",c);p.on("modelSelected",c);function t(z,F,v,A){var E=s.subset2canvas(z,F,v,A);var D=r.subset2canvas(z,F,v,A);q.setData(E);p.setData(D);var x="models_"+n.config.id;while(1){var y=document.getElementById(x);if(y==null){break}y.parentNode.removeChild(y)}q.paint();p.paint();var C=q.groups.getList();for(var B in C){n.Toolbar.addItem(B);b(B)}C=p.groups.getList();for(var B in C){n.Toolbar.addItem(B);b(B)}}return{dataA:s,dataB:r,canvasA:q,canvasB:p,parse:u,paint:t}})();var m=e;var a=[{index:0,min:1/100,max:1/5,bases:1,pixels:100,cache:1000},{index:1,min:1/5,max:1/1,bases:1,pixels:10,cache:1000},{index:2,min:1/1,max:10/1,bases:1,pixels:1,cache:10000},{index:3,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:4,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:5,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000}];var j=null;function b(p){if(!j){n.ContextMenu.addItems(["-","Series"]);j={}}if(j[p]==undefined){j[p]=true;n.ContextMenu.addItems([new Ext.menu.CheckItem({text:p,checked:true,handler:function(){m.canvasA.groups.toggle(p,!this.checked);m.canvasB.groups.toggle(p,!this.checked);m.canvasA.refresh();m.canvasB.refresh()}})])}}function c(p){AnnoJ.getGUI().InfoBox.echo("<div class='waiting'>Loading...</div>");BaseJS.request({url:n.config.data,method:"GET",requestJSON:false,data:{action:"describe",id:p},success:function(q){if(q.success){var s=q.data;var r="<table>";r+="<tr><td><b>Gene ID: </b></td><td width='100%'>"+s.id+"</td></tr>";r+="<tr><td><b>Assembly: </b></td><td>"+s.assembly+"</td></tr>";r+="<tr><td><b>Position: </b></td><td>"+s.start+".."+s.end+"</td></tr>";r+="<tr><td><b>Description:</b></td><td></td></tr>";r+="<tr><td colspan='2'>"+s.description+"</td></tr>";r+="</table>";AnnoJ.getGUI().InfoBox.echo(r)}else{AnnoJ.getGUI().InfoBox.echo("Error: failed to retrieve gene information. Server says: "+q.message)}},failure:function(q){AnnoJ.getGUI().InfoBox.echo("Error: failed to retrieve gene information from the server")}})}this.getPolicy=function(p){var r=p.bases/p.pixels;for(var q=0;q<a.length;q++){if(r>=a[q].min&&r<a[q].max){return a[q]}}return null};this.rescale=function(p){var p=parseFloat(p*2)||0;m.canvasA.setScaler(p);m.canvasB.setScaler(p);m.canvasA.refresh();m.canvasB.refresh()};this.l_rescale=function(p){m.canvasA.setScaler(p);m.canvasB.setScaler(p);m.canvasA.refresh();m.canvasB.refresh()};this.clearCanvas=function(){m.canvasA.clear();m.canvasB.clear()};this.paintCanvas=function(s,t,q,u){m.paint(s,t,q,u)};this.refreshCanvas=function(){m.canvasA.refresh();m.canvasB.refresh()};this.resizeCanvas=function(){m.canvasA.refresh();m.canvasB.refresh()};this.clearData=function(){m.dataA.clear();m.dataB.clear()};this.pruneData=function(q,p){m.dataA.prune(q,p);m.dataB.prune(q,p)};this.parseData=function(p){m.parse(p)}};Ext.extend(AnnoJ.ModelsTrack,AnnoJ.BrowserTrack);AnnoJ.MicroarrayTrack=function(g){var j=this;AnnoJ.MicroarrayTrack.superclass.constructor.call(j,g);var e={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below"};Ext.applyIf(j.config,e);var d=new Ext.Element(document.createElement("DIV"));var c=new Ext.Element(document.createElement("DIV"));d.addClass(j.config.clsAbove);c.addClass(j.config.clsBelow);d.setStyle("position","relative");c.setStyle("position","relative");d.setStyle("width","100%");c.setStyle("width","100%");if(j.config.single){d.setStyle("height",j.Canvas.ext.getHeight());c.setStyle("display","none")}else{d.setStyle("height","49%");c.setStyle("height","49%");d.setStyle("borderBottom","dotted black 1px")}d.appendTo(j.Canvas.ext);c.appendTo(j.Canvas.ext);var k=(function(){var o=new HistogramData();var n=new HistogramData();function q(s){for(var r in s){j.Toolbar.addItem(r);b(r)}o.parse(s,true);n.parse(s,false)}var m=new HistogramCanvas();var l=new HistogramCanvas();l.flipY();m.setContainer(d.dom);l.setContainer(c.dom);function p(v,s,r,x){var u=o.subset2canvas(v,s,r,x);var t=n.subset2canvas(v,s,r,x);m.setData(u);l.setData(t);m.paint();l.paint()}return{dataA:o,dataB:n,canvasA:m,canvasB:l,parse:q,paint:p}})();var i=k;var a=[{index:0,min:1/100,max:10/1,bases:1,pixels:1,cache:10000},{index:1,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:2,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:3,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:4,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];var f=null;function b(l){if(!f){j.ContextMenu.addItems(["-","Series"]);f={}}if(f[l]==undefined){f[l]=true;j.ContextMenu.addItems([new Ext.menu.CheckItem({text:l,checked:true,handler:function(){i.canvasA.groups.toggle(l,!this.checked);i.canvasB.groups.toggle(l,!this.checked);i.canvasA.refresh();i.canvasB.refresh()}})])}}this.getPolicy=function(l){var n=l.bases/l.pixels;i=k;for(var m=0;m<a.length;m++){if(n>=a[m].min&&n<a[m].max){return a[m]}}return null};this.rescale=function(l){var l=Math.pow(l*2,4);i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refresh();i.canvasB.refresh()};this.l_rescale=function(l){i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refresh();i.canvasB.refresh()};this.clearCanvas=function(){i.canvasA.clear();i.canvasB.clear()};this.paintCanvas=function(n,o,m,q){i.paint(n,o,m,q)};this.refreshCanvas=function(){i.canvasA.refresh(true);i.canvasB.refresh(true)};this.resizeCanvas=function(){i.canvasA.refresh(true);i.canvasB.refresh(true)};this.clearData=function(){i.dataA.clear();i.dataB.clear()};this.pruneData=function(m,l){i.dataA.prune(m,l);i.dataB.prune(m,l)};this.parseData=function(l){i.parse(l)}};Ext.extend(AnnoJ.MicroarrayTrack,AnnoJ.BrowserTrack);AnnoJ.MethTrack=function(l){var n=this;AnnoJ.MethTrack.superclass.constructor.call(n,l);var f={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below"};Ext.applyIf(n.config,f);var e=new Ext.Element(document.createElement("DIV"));var c=new Ext.Element(document.createElement("DIV"));e.addClass(n.config.clsAbove);c.addClass(n.config.clsBelow);e.setStyle("position","relative");c.setStyle("position","relative");e.setStyle("width","100%");c.setStyle("width","100%");if(n.config.single){e.setStyle("height",n.Canvas.ext.getHeight());c.setStyle("display","none")}else{e.setStyle("height","49%");c.setStyle("height","49%");e.setStyle("borderBottom","dotted black 1px")}e.appendTo(n.Canvas.ext);c.appendTo(n.Canvas.ext);var p=new Ext.menu.CheckItem({text:"CG",handler:d});var i=new Ext.menu.CheckItem({text:"CHG",handler:d});var g=new Ext.menu.CheckItem({text:"CHH",handler:d});p.setChecked(true);i.setChecked(true);g.setChecked(true);n.ContextMenu.addItems([p,i,g]);var b=new Ext.Toolbar.Button({text:"CG",iconCls:"silk_bullet_orange",tooltip:"Show/hide CG methylation",handler:d});var k=new Ext.Toolbar.Button({text:"CHG",iconCls:"silk_bullet_blue",tooltip:"Show/hide CHG methylation",handler:d});var j=new Ext.Toolbar.Button({text:"CHH",iconCls:"silk_bullet_pink",tooltip:"Show/hide CHH methylation",handler:d});n.Toolbar.insert(4,j);n.Toolbar.insert(4,k);n.Toolbar.insert(4,b);function d(r){var q=true;if(r.iconCls){q=r.iconCls=="silk_bullet_white"}else{q=!r.checked}if(r.text=="CG"){b.setIconClass(q?"silk_bullet_orange":"silk_bullet_white");if(r.iconCls){p.setChecked(q)}}else{if(r.text=="CHG"){k.setIconClass(q?"silk_bullet_blue":"silk_bullet_white");if(r.iconCls){i.setChecked(q)}}else{if(r.text=="CHH"){j.setIconClass(q?"silk_bullet_pink":"silk_bullet_white");if(r.iconCls){g.setChecked(q)}}else{return}}}m.canvasA.groups.toggle(r.text,q);m.canvasB.groups.toggle(r.text,q);m.canvasA.refresh();m.canvasB.refresh()}var o=(function(){var t=new HistogramData();var s=new HistogramData();function v(x){t.parse(x,true);s.parse(x,false)}var r=new HistogramCanvas();var q=new HistogramCanvas();q.flipY();r.setContainer(e.dom);q.setContainer(c.dom);function u(C,z,y,D){var B=t.subset2canvas(C,z,y,D);var A=s.subset2canvas(C,z,y,D);r.setData(B);q.setData(A);var x=Math.max(r.getMax()||0,q.getMax()||0);if(!AnnoJ.config.maxlist){AnnoJ.config.maxlist=new Array()}AnnoJ.config.maxlist[n.config.id]=Math.ceil(x);r.paint();q.paint()}return{dataA:t,dataB:s,canvasA:r,canvasB:q,parse:v,paint:u}})();var m=o;var a=[{index:0,min:1/100,max:10/1,bases:1,pixels:1,cache:10000},{index:1,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:2,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:3,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:4,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];this.getPolicy=function(q){var s=q.bases/q.pixels;m=o;for(var r=0;r<a.length;r++){if(s>=a[r].min&&s<a[r].max){return a[r]}}return null};this.rescale=function(q){var q=Math.pow(q*2,4);m.canvasA.setScaler(q);m.canvasB.setScaler(q);m.canvasA.refresh();m.canvasB.refresh()};this.l_rescale=function(q){m.canvasA.setScaler(q);m.canvasB.setScaler(q);m.canvasA.refresh();m.canvasB.refresh()};this.clearCanvas=function(){m.canvasA.clear();m.canvasB.clear()};this.paintCanvas=function(s,t,q,u){m.paint(s,t,q,u)};this.refreshCanvas=function(){m.canvasA.refresh(true);m.canvasB.refresh(true)};this.resizeCanvas=function(){m.canvasA.refresh(true);m.canvasB.refresh(true)};this.clearData=function(){m.dataA.clear();m.dataB.clear()};this.pruneData=function(r,q){m.dataA.prune(r,q);m.dataB.prune(r,q)};this.parseData=function(q){m.parse(q)}};Ext.extend(AnnoJ.MethTrack,AnnoJ.BrowserTrack);AnnoJ.ReadsTrack=function(i){var k=this;AnnoJ.ReadsTrack.superclass.constructor.call(k,i);var e={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below",slider:0.5,boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:6};Ext.applyIf(k.config,e);var d=new Ext.Element(document.createElement("DIV"));var c=new Ext.Element(document.createElement("DIV"));d.addClass(k.config.clsAbove);c.addClass(k.config.clsBelow);d.setStyle("position","relative");c.setStyle("position","relative");d.setStyle("width","100%");c.setStyle("width","100%");if(k.config.single){d.setStyle("height",k.Canvas.ext.getHeight());c.setStyle("display","none")}else{d.setStyle("height","49%");c.setStyle("height","49%");d.setStyle("borderBottom","dotted black 1px")}d.appendTo(k.Canvas.ext);c.appendTo(k.Canvas.ext);var l=(function(){var p=new HistogramData();var o=new HistogramData();function r(t){for(var s in t){b(s);k.Toolbar.addItem(s)}p.parse(t,true);o.parse(t,false)}var n=new HistogramCanvas();var m=new HistogramCanvas();m.flipY();function q(y,u,t,z){var x=p.subset2canvas(y,u,t,z);var v=o.subset2canvas(y,u,t,z);n.setData(x);m.setData(v);var s=Math.max(n.getMax()||0,m.getMax()||0);if(!AnnoJ.config.maxlist){AnnoJ.config.maxlist=new Array()}AnnoJ.config.maxlist[k.config.id]=Math.ceil(s);n.paint();m.paint()}return{dataA:p,dataB:o,canvasA:n,canvasB:m,parse:r,paint:q}})();var g=(function(){var p=new ReadsList();var o=new ReadsList();function r(t){for(var s in t){b(s);k.Toolbar.addItem(s)}p.parse(t,true);o.parse(t,false)}var n=new ReadsCanvas({scaler:k.config.slider,oxHeight:k.config.boxHeight,boxHeightMax:k.config.boxHeightMax,boxHeightMin:k.config.boxHeightMin,boxBlingLimit:k.config.boxBlingLimit});var m=new ReadsCanvas({scaler:k.config.slider,boxHeight:k.config.boxHeight,boxHeightMax:k.config.boxHeightMax,boxHeightMin:k.config.boxHeightMin,boxBlingLimit:k.config.boxBlingLimit});m.flipY();function q(x,t,s,y){var v=p.subset2canvas(x,t,s,y);var u=o.subset2canvas(x,t,s,y);n.setData(v);m.setData(u);n.paint();m.paint()}return{dataA:p,dataB:o,canvasA:n,canvasB:m,parse:r,paint:q}})();var j=l;var a=[{index:0,min:1/100,max:1/1,bases:1,pixels:100,cache:1000},{index:1,min:1/1,max:10/1,bases:1,pixels:1,cache:10000},{index:2,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:3,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:4,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:5,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];var f=null;function b(m){if(!f){k.ContextMenu.addItems(["-","Series"]);f={}}if(f[m]==undefined){f[m]=true;k.ContextMenu.addItems([new Ext.menu.CheckItem({text:m,checked:true,handler:function(){j.canvasA.groups.toggle(m,!this.checked);j.canvasB.groups.toggle(m,!this.checked);j.canvasA.refresh();j.canvasB.refresh()}})])}}this.getPolicy=function(m){var o=m.bases/m.pixels;j.canvasA.setContainer(null);j.canvasB.setContainer(null);j=(o<10)?g:l;j.canvasA.setContainer(d.dom);j.canvasB.setContainer(c.dom);for(var n=0;n<a.length;n++){if(o>=a[n].min&&o<a[n].max){return a[n]}}return null};this.rescale=function(m){var m=(j==l)?Math.pow(m*2,4):m;j.canvasA.setScaler(m);j.canvasB.setScaler(m);j.canvasA.refresh();j.canvasB.refresh()};this.l_rescale=function(m){j.canvasA.setScaler(m);j.canvasB.setScaler(m);j.canvasA.refresh();j.canvasB.refresh()};this.clearCanvas=function(){j.canvasA.clear();j.canvasB.clear()};this.paintCanvas=function(n,o,m,q){j.paint(n,o,m,q)};this.refreshCanvas=function(){j.canvasA.refresh(true);j.canvasB.refresh(true)};this.resizeCanvas=function(){j.canvasA.refresh(true);j.canvasB.refresh(true)};this.clearData=function(){j.dataA.clear();j.dataB.clear()};this.pruneData=function(n,m){j.dataA.prune(n,m);j.dataB.prune(n,m)};this.parseData=function(m){j.parse(m)}};Ext.extend(AnnoJ.ReadsTrack,AnnoJ.BrowserTrack);AnnoJ.SmallReadsTrack=function(r){var n=this;AnnoJ.SmallReadsTrack.superclass.constructor.call(n,r);var m={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below",slider:0.5,boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:6};Ext.applyIf(n.config,m);var p=new Ext.Element(document.createElement("DIV"));var o=new Ext.Element(document.createElement("DIV"));p.addClass(n.config.clsAbove);o.addClass(n.config.clsBelow);p.setStyle("position","relative");o.setStyle("position","relative");p.setStyle("width","100%");o.setStyle("width","100%");if(n.config.single){p.setStyle("height",n.Canvas.ext.getHeight());o.setStyle("display","none")}else{p.setStyle("height","49%");o.setStyle("height","49%");p.setStyle("borderBottom","dotted black 1px")}p.appendTo(n.Canvas.ext);o.appendTo(n.Canvas.ext);var d=new Ext.menu.CheckItem({text:"Show Multi-Mappers",handler:g});var q=new Ext.menu.CheckItem({text:"21mers",handler:t});var f=new Ext.menu.CheckItem({text:"22mers",handler:t});var u=new Ext.menu.CheckItem({text:"23mers",handler:t});var k=new Ext.menu.CheckItem({text:"24mers",handler:t});var z=new Ext.menu.CheckItem({text:"Others",handler:t});d.setChecked(true);q.setChecked(true);f.setChecked(true);u.setChecked(true);k.setChecked(true);z.setChecked(true);n.ContextMenu.addItems([d,q,f,u,k,z]);var j=new Ext.Toolbar.Button({text:"Multis",iconCls:"silk_bullet_orange",tooltip:"Show or hide read that map to multiple locations",handler:g});var x=new Ext.Toolbar.Button({text:"21mers",iconCls:"silk_bullet_orange",tooltip:"Show or hide 21mers",handler:t});var l=new Ext.Toolbar.Button({text:"22mers",iconCls:"silk_bullet_orange",tooltip:"Show or hide 22mers",handler:t});var c=new Ext.Toolbar.Button({text:"23mers",iconCls:"silk_bullet_orange",tooltip:"Show or hide 23mers",handler:t});var s=new Ext.Toolbar.Button({text:"24mers",iconCls:"silk_bullet_orange",tooltip:"Show or hide 24mers",handler:t});var e=new Ext.Toolbar.Button({text:"Others",iconCls:"silk_bullet_orange",tooltip:"Show or hide reads other than 21mers or 24mers",handler:t});n.Toolbar.insert(4,j);n.Toolbar.insert(4,e);n.Toolbar.insert(4,s);n.Toolbar.insert(4,c);n.Toolbar.insert(4,l);n.Toolbar.insert(4,x);function g(C){var B=true;if(C.iconCls){B=C.iconCls=="silk_bullet_white"}else{B=!C.checked}j.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){d.setChecked(B)}b.canvasA.toggleSpecial("multi_mapper",B);b.canvasB.toggleSpecial("multi_mapper",B);b.canvasA.refresh();b.canvasB.refresh()}function t(C){var B=true;if(C.iconCls){B=C.iconCls=="silk_bullet_white"}else{B=!C.checked}if(C.text=="21mers"){x.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){q.setChecked(B)}}else{if(C.text=="22mers"){l.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){f.setChecked(B)}}else{if(C.text=="23mers"){c.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){u.setChecked(B)}}else{if(C.text=="24mers"){s.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){k.setChecked(B)}}else{if(C.text=="Others"){e.setIconClass(B?"silk_bullet_orange":"silk_bullet_white");if(C.iconCls){z.setChecked(B)}}else{return}}}}}b.canvasA.toggleSpecial(C.text,B);b.canvasB.toggleSpecial(C.text,B);b.canvasA.refresh();b.canvasB.refresh()}var A=(function(){var E=new HistogramData();var D=new HistogramData();function G(I){for(var H in I){i(H);n.Toolbar.addItem(H)}E.parse(I,true);D.parse(I,false)}var C=new HistogramCanvas();var B=new HistogramCanvas();B.flipY();function F(M,J,I,N){var L=E.subset2canvas(M,J,I,N);var K=D.subset2canvas(M,J,I,N);C.setData(L);B.setData(K);var H=Math.max(C.getMax()||0,B.getMax()||0);if(!AnnoJ.config.maxlist){AnnoJ.config.maxlist=new Array()}AnnoJ.config.maxlist[n.config.id]=Math.ceil(H);C.paint();B.paint()}return{dataA:E,dataB:D,canvasA:C,canvasB:B,parse:G,paint:F}})();var y=(function(){var E=new SmallReadsList();var D=new SmallReadsList();function G(I){for(var H in I){n.Toolbar.addItem(H);i(H)}E.parse(I,true);D.parse(I,false)}var C=new ReadsCanvas({scaler:n.config.slider,boxHeight:n.config.boxHeight,boxHeightMax:n.config.boxHeightMax,boxHeightMin:n.config.boxHeightMin,boxBlingLimit:n.config.boxBlingLimit});var B=new ReadsCanvas({scaler:n.config.slider,boxHeight:n.config.boxHeight,boxHeightMax:n.config.boxHeightMax,boxHeightMin:n.config.boxHeightMin,boxBlingLimit:n.config.boxBlingLimit});B.flipY();function F(L,I,H,M){var K=E.subset2canvas(L,I,H,M);var J=D.subset2canvas(L,I,H,M);C.setData(K);B.setData(J);C.paint();B.paint()}return{dataA:E,dataB:D,canvasA:C,canvasB:B,parse:G,paint:F}})();var b=A;var a=[{index:0,min:1/100,max:1/1,bases:1,pixels:100,cache:1000},{index:1,min:1/1,max:10/1,bases:1,pixels:1,cache:10000},{index:2,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:3,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:4,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:5,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];var v=null;function i(B){if(!v){n.ContextMenu.addItems(["-","Series"]);v={}}if(v[B]==undefined){v[B]=true;n.ContextMenu.addItems([new Ext.menu.CheckItem({text:B,checked:true,handler:function(){b.canvasA.groups.toggle(B,!this.checked);b.canvasB.groups.toggle(B,!this.checked);b.canvasA.refresh();b.canvasB.refresh()}})])}}this.getPolicy=function(B){var D=B.bases/B.pixels;b.canvasA.setContainer(null);b.canvasB.setContainer(null);b=(D<10)?y:A;b.canvasA.setContainer(p.dom);b.canvasB.setContainer(o.dom);for(var C=0;C<a.length;C++){if(D>=a[C].min&&D<a[C].max){return a[C]}}return null};this.rescale=function(B){var B=(b==A)?Math.pow(B*2,4):B;b.canvasA.setScaler(B);b.canvasB.setScaler(B);b.canvasA.refresh();b.canvasB.refresh()};this.l_rescale=function(B){b.canvasA.setScaler(B);b.canvasB.setScaler(B);b.canvasA.refresh();b.canvasB.refresh()};this.clearCanvas=function(){b.canvasA.clear();b.canvasB.clear()};this.paintCanvas=function(C,D,B,E){b.paint(C,D,B,E)};this.refreshCanvas=function(){b.canvasA.refresh(true);b.canvasB.refresh(true)};this.resizeCanvas=function(){b.canvasA.refresh(true);b.canvasB.refresh(true)};this.clearData=function(){b.dataA.clear();b.dataB.clear()};this.pruneData=function(C,B){b.dataA.prune(C,B);b.dataB.prune(C,B)};this.parseData=function(B){b.parse(B)}};Ext.extend(AnnoJ.SmallReadsTrack,AnnoJ.BrowserTrack);AnnoJ.HiCTrack=function(g){var j=this;AnnoJ.HiCTrack.superclass.constructor.call(j,g);var e={single:true,clsAbove:"AJ_above",clsBelow:"AJ_below",slider:0.5,boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:6};Ext.applyIf(j.config,e);var d=new Ext.Element(document.createElement("DIV"));var c=new Ext.Element(document.createElement("DIV"));d.addClass(j.config.clsAbove);c.addClass(j.config.clsBelow);d.setStyle("position","relative");c.setStyle("position","relative");d.setStyle("width","100%");c.setStyle("width","100%");if(j.config.single){d.setStyle("height","100%");c.setStyle("display","none")}else{d.setStyle("height","49%");c.setStyle("height","49%");d.setStyle("borderBottom","dotted black 1px")}d.appendTo(j.Canvas.ext);c.appendTo(j.Canvas.ext);var k=(function(){var o=new HistogramData();var n=new HistogramData();function q(s){for(var r in s){b(r);j.Toolbar.addItem(r)}o.parse(s,true);n.parse(s,false)}var m=new HistogramCanvas();var l=new HistogramCanvas();l.flipY();function p(u,s,r,v){var t=o.subset2canvas(u,s,r,v);m.setData(t);m.paintMap()}return{dataA:o,dataB:n,canvasA:m,canvasB:l,parse:q,paint:p}})();var i=k;var a=[{index:0,min:1/100,max:1/1,bases:1,pixels:100,cache:1000},{index:1,min:1/1,max:10/1,bases:1,pixels:1,cache:10000},{index:2,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:3,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:4,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:5,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];var f=null;function b(l){if(!f){j.ContextMenu.addItems(["-","Series"]);f={}}if(f[l]==undefined){f[l]=true;j.ContextMenu.addItems([new Ext.menu.CheckItem({text:l,checked:true,handler:function(){i.canvasA.groups.toggle(l,!this.checked);i.canvasB.groups.toggle(l,!this.checked);i.canvasA.refresh();i.canvasB.refresh()}})])}}this.getPolicy=function(l){var n=l.bases/l.pixels;i.canvasA.setContainer(null);i.canvasB.setContainer(null);i=k;i.canvasA.setContainer(d.dom);i.canvasB.setContainer(c.dom);for(var m=0;m<a.length;m++){if(n>=a[m].min&&n<a[m].max){return a[m]}}return null};this.rescale=function(l){var l=(i==k)?Math.pow(l*2,4):l;i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refreshMap();i.canvasB.refreshMap()};this.l_rescale=function(l){i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refreshMap();i.canvasB.refreshMap()};this.clearCanvas=function(){i.canvasA.clear();i.canvasB.clear()};this.paintCanvas=function(n,o,m,q){i.paint(n,o,m,q)};this.refreshCanvas=function(){i.canvasA.refreshMap(true);i.canvasB.refreshMap(true)};this.resizeCanvas=function(){i.canvasA.refreshMap(true);i.canvasB.refreshMap(true)};this.clearData=function(){i.dataA.clear();i.dataB.clear()};this.pruneData=function(m,l){i.dataA.prune(m,l);i.dataB.prune(m,l)};this.parseData=function(l){i.parse(l)}};Ext.extend(AnnoJ.HiCTrack,AnnoJ.BrowserTrack);AnnoJ.IntensityTrack=function(g){var j=this;AnnoJ.IntensityTrack.superclass.constructor.call(j,g);var e={single:false,clsAbove:"AJ_above",clsBelow:"AJ_below",slider:0.5,boxHeight:10,boxHeightMax:24,boxHeightMin:1,boxBlingLimit:6};Ext.applyIf(j.config,e);var d=new Ext.Element(document.createElement("DIV"));var c=new Ext.Element(document.createElement("DIV"));d.addClass(j.config.clsAbove);c.addClass(j.config.clsBelow);d.setStyle("position","relative");c.setStyle("position","relative");d.setStyle("width","100%");c.setStyle("width","100%");if(j.config.single){d.setStyle("height",j.Canvas.ext.getHeight());c.setStyle("display","none")}else{d.setStyle("height","49%");c.setStyle("height","49%");d.setStyle("borderBottom","dotted black 1px")}d.appendTo(j.Canvas.ext);c.appendTo(j.Canvas.ext);var k=(function(){var o=new HistogramData();var n=new HistogramData();function q(s){for(var r in s){j.Toolbar.addItem(r);b(r)}o.parse(s,true);n.parse(s,false)}var m=new HistogramCanvas();var l=new HistogramCanvas();l.flipY();function p(x,t,s,y){var v=o.subset2canvas(x,t,s,y);var u=n.subset2canvas(x,t,s,y);m.setData(v);l.setData(u);var r=Math.max(m.getMax()||0,l.getMax()||0);if(!AnnoJ.config.maxlist){AnnoJ.config.maxlist=new Array()}AnnoJ.config.maxlist[j.config.id]=Math.ceil(r);m.paint();l.paint()}return{dataA:o,dataB:n,canvasA:m,canvasB:l,parse:q,paint:p}})();var i=k;var a=[{index:0,min:1/100,max:1/1,bases:1,pixels:10,cache:1000},{index:1,min:1/1,max:10/1,bases:1,pixels:1,cache:10000},{index:2,min:10/1,max:100/1,bases:10,pixels:1,cache:100000},{index:3,min:100/1,max:1000/1,bases:100,pixels:1,cache:1000000},{index:4,min:1000/1,max:10000/1,bases:1000,pixels:1,cache:10000000},{index:5,min:10000/1,max:200001/1,bases:10000,pixels:1,cache:100000000}];var f=null;function b(l){if(!f){j.ContextMenu.addItems(["-","Series"]);f={}}if(f[l]==undefined){f[l]=true;j.ContextMenu.addItems([new Ext.menu.CheckItem({text:l,checked:true,handler:function(){i.canvasA.groups.toggle(l,!this.checked);i.canvasB.groups.toggle(l,!this.checked);i.canvasA.refresh();i.canvasB.refresh()}})])}}this.getPolicy=function(l){var n=l.bases/l.pixels;i.canvasA.setContainer(null);i.canvasB.setContainer(null);i=k;i.canvasA.setContainer(d.dom);i.canvasB.setContainer(c.dom);for(var m=0;m<a.length;m++){if(n>=a[m].min&&n<a[m].max){return a[m]}}return null};this.rescale=function(l){var l=(i==k)?Math.pow(l*2,4):l;i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refresh();i.canvasB.refresh()};this.l_rescale=function(l){i.canvasA.setScaler(l);i.canvasB.setScaler(l);i.canvasA.refresh();i.canvasB.refresh()};this.clearCanvas=function(){i.canvasA.clear();i.canvasB.clear()};this.paintCanvas=function(n,o,m,q){i.paint(n,o,m,q)};this.refreshCanvas=function(){i.canvasA.refresh(true);i.canvasB.refresh(true)};this.resizeCanvas=function(){i.canvasA.refresh(true);i.canvasB.refresh(true)};this.clearData=function(){i.dataA.clear();i.dataB.clear()};this.pruneData=function(m,l){i.dataA.prune(m,l);i.dataB.prune(m,l)};this.parseData=function(l){i.parse(l)}};Ext.extend(AnnoJ.IntensityTrack,AnnoJ.BrowserTrack);